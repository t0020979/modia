<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modia ‚Äî –¢–µ—Å—Ç FieldValidator (–°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è)</title>

  <!-- ‚úÖ jQuery CDN (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û) -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <!-- Bootstrap 4 CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <!-- ‚úÖ Modia CSS (—Å–∫—Ä—ã–≤–∞–µ—Ç .error-templates) -->
  <link rel="stylesheet" href="../../../modia/modia.css">

  <!-- –ü—Ä–∏–º–µ—Ä—ã CSS -->
  <link rel="stylesheet" href="../../../examples/examples.css">

  <style>
    .test-section {
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 20px;
      margin-bottom: 20px;
      background: #f8f9fa;
    }

    .instruction-box {
      background: #e7f3ff;
      border-left: 4px solid #007bff;
      padding: 10px;
      margin: 10px 0;
      font-size: 13px;
    }

    .console-log {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 4px;
      height: 200px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 20px;
    }

    .test-result {
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
    }

    .test-result.pass {
      background: #d4edda;
      color: #155724;
    }

    .test-result.fail {
      background: #f8d7da;
      color: #721c24;
    }

    .test-result.pending {
      background: #fff3cd;
      color: #856404;
    }

    .auto-test-running {
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% {
        opacity: 1;
      }

      50% {
        opacity: 0.6;
      }

      100% {
        opacity: 1;
      }
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
    .character-selector {
      display: flex;
      gap: 10px;
      padding: 10px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      background: white;
    }

    .character-btn {
      padding: 10px 20px;
      border: 2px solid #007bff;
      background: white;
      border-radius: 4px;
      cursor: pointer;
    }

    .character-btn.selected {
      background: #007bff;
      color: white;
    }

    .character-btn:hover {
      background: #e7f3ff;
    }

    .character-btn.selected:hover {
      background: #0056b3;
    }
  </style>
</head>

<body>
  <div class="container mt-5">
    <h1>üß™ –¢–µ—Å—Ç FieldValidator Service</h1>
    <p class="lead">–°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è + –≤–Ω–µ—à–Ω–∏–π —ç–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏</p>

    <!-- –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div class="expected-result alert alert-info">
      <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
      <ul>
        <li><strong>–°–ø–æ—Å–æ–± 1:</strong> –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ + –≤–Ω–µ—à–Ω–∏–π —ç–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏ (<code>data-input-error-screen</code>)</li>
        <li><strong>–°–ø–æ—Å–æ–± 2:</strong> –í–∏–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç + –≤–Ω–µ—à–Ω–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∑–Ω–∞—á–µ–Ω–∏—è
          (<code>data-input-value-source</code>)</li>
        <li>–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –≤–∏–¥–∏–º–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ, –∞ –Ω–µ –Ω–∞ —Å–∫—Ä—ã—Ç–æ–º –ø–æ–ª–µ</li>
        <li><code>getFieldValue()</code> –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ–≥–æ –ø–æ–ª—è</li>
        <li>–í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –æ–±–æ–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤</li>
      </ul>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 1: –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ + –≤–Ω–µ—à–Ω–∏–π —ç–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏ -->
    <div class="test-section" id="section_1">
      <h3>üìç –°–µ–∫—Ü–∏—è 1: –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ + –≤–Ω–µ—à–Ω–∏–π —ç–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏</h3>

      <div class="instruction-box">
        <strong>üìã –†—É—á–Ω–æ–π —Ç–µ—Å—Ç:</strong><br>
        1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–ß–µ–±—É—Ä–∞—à–∫–∞/–ö—Ä–æ–∫–æ–¥–∏–ª)<br>
        2. –ù–∞–∂–º–∏—Ç–µ <code>üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</code> ‚Üí –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å <code>true</code><br>
        3. –ù–∞–∂–º–∏—Ç–µ <code>üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä</code><br>
        4. –ù–∞–∂–º–∏—Ç–µ <code>üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</code> ‚Üí –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å <code>false</code>, –æ—à–∏–±–∫–∞ –Ω–∞ –≤–∏–¥–∏–º–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
      </div>

      <form id="form-hidden-1" novalidate>
        <div class="form-group" id="fg-character-1">
          <label>–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ *</label>

          <!-- –í–∏–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–∫–∏ -->
          <div class="character-selector" id="character-selector-1">
            <button type="button" class="character-btn" data-select="cheburashka">–ß–µ–±—É—Ä–∞—à–∫–∞</button>
            <button type="button" class="character-btn" data-select="crocodile">–ö—Ä–æ–∫–æ–¥–∏–ª –ì–µ–Ω–∞</button>
            <button type="button" class="character-btn" data-select="monkey">–û–±–µ–∑—å—è–Ω–∞</button>
          </div>

          <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º -->
          <input type="hidden" id="character_id_1" name="character_id" required
            data-input-error-screen="#character-selector-1">
        </div>

        <div class="error-templates">
          <span class="text-danger" data-rule="required">–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</span>
        </div>
      </form>

      <div class="test-buttons mt-3">
        <button id="btn_validate_h1" class="btn btn-primary">üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="btn_clear_h1" class="btn btn-secondary">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É</button>
        <button id="btn_clear_selection_h1" class="btn btn-warning">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä</button>
        <button id="btn_check_value_h1" class="btn btn-info">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</button>
      </div>

      <div id="result_1" class="test-result pending">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 2: –í–∏–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç + –≤–Ω–µ—à–Ω–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∑–Ω–∞—á–µ–Ω–∏—è -->
    <div class="test-section" id="section_2">
      <h3>üìç –°–µ–∫—Ü–∏—è 2: –í–∏–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç + –≤–Ω–µ—à–Ω–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∑–Ω–∞—á–µ–Ω–∏—è</h3>

      <div class="instruction-box">
        <strong>üìã –†—É—á–Ω–æ–π —Ç–µ—Å—Ç:</strong><br>
        1. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤ –≤–∏–¥–∏–º–æ–µ –ø–æ–ª–µ<br>
        2. –ù–∞–∂–º–∏—Ç–µ <code>üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</code> ‚Üí –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å <code>true</code><br>
        3. –û—á–∏—Å—Ç–∏—Ç–µ –≤–∏–¥–∏–º–æ–µ –ø–æ–ª–µ<br>
        4. –ù–∞–∂–º–∏—Ç–µ <code>üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</code> ‚Üí –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å <code>false</code>
      </div>

      <form id="form-hidden-2" novalidate>
        <div class="form-group" id="fg-description-2">
          <label>–û–ø–∏—Å–∞–Ω–∏–µ *</label>

          <!-- –í–∏–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å –≤–Ω–µ—à–Ω–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∑–Ω–∞—á–µ–Ω–∏—è -->
          <div class="visible-field" id="visible-description" required data-input-value-source="#hidden-description"
            contenteditable="true"
            style="border: 1px solid #ced4da; padding: 10px; min-height: 60px; background: white;">
            –í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ...
          </div>

          <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º -->
          <textarea id="hidden-description" name="description" class="d-none"></textarea>
        </div>

        <div class="error-templates">
          <span class="text-danger" data-rule="required">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ</span>
        </div>
      </form>

      <div class="test-buttons mt-3">
        <button id="btn_validate_h2" class="btn btn-primary">üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="btn_clear_h2" class="btn btn-secondary">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É</button>
        <button id="btn_sync_value_h2" class="btn btn-info">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</button>
        <button id="btn_check_value_h2" class="btn btn-info">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</button>
      </div>

      <div id="result_2" class="test-result pending">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ $valueSource –∏ $errorScreen -->
    <div class="test-section" id="section_3">
      <h3>üìç –°–µ–∫—Ü–∏—è 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ $valueSource –∏ $errorScreen</h3>

      <div class="instruction-box">
        <strong>üìã –†—É—á–Ω–æ–π —Ç–µ—Å—Ç:</strong><br>
        1. –ù–∞–∂–º–∏—Ç–µ <code>üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</code><br>
        2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: <code>$valueSource</code> = —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ, <code>$errorScreen</code> = –≤–∏–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç<br>
        3. –û—à–∏–±–∫–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –Ω–∞ <code>$errorScreen</code>, –∞ –Ω–µ –Ω–∞ <code>$valueSource</code>
      </div>

      <form id="form-hidden-3" novalidate>
        <div class="form-group" id="fg-test-3">
          <label>–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ *</label>

          <div class="character-selector" id="test-selector-3">
            <button type="button" class="character-btn" data-select="option1">–û–ø—Ü–∏—è 1</button>
            <button type="button" class="character-btn" data-select="option2">–û–ø—Ü–∏—è 2</button>
          </div>

          <input type="hidden" id="test_field_3" name="test_field" required data-input-error-screen="#test-selector-3">
        </div>

        <div class="error-templates">
          <span class="text-danger" data-rule="required">–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é</span>
        </div>
      </form>

      <div class="test-buttons mt-3">
        <button id="btn_check_config_h3" class="btn btn-info">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
        <button id="btn_validate_h3" class="btn btn-primary">üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>

      <div id="result_3" class="test-result pending">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –∞–≤—Ç–æ-—Ç–µ—Å—Ç–∞ -->
    <div class="test-buttons mt-4">
      <button id="btn_auto_test_all" class="btn btn-success btn-lg">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ-—Ç–µ—Å—Ç –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π</button>
      <button id="btn_stop_test" class="btn btn-danger btn-lg">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
    </div>

    <div id="auto_test_status" class="alert alert-info mt-3" style="display: none;">
      –°—Ç–∞—Ç—É—Å: <span id="auto_test_status_text">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
    </div>

    <!-- –ö–æ–Ω—Å–æ–ª—å –ª–æ–≥ -->
    <div class="console-log" id="console-log">
      <div class="text-muted"><small>[00:00:00] –ö–æ–Ω—Å–æ–ª—å –ª–æ–≥–≥–µ—Ä–∞ –≥–æ—Ç–æ–≤–∞...</small></div>
    </div>

    <div class="test-buttons mt-2">
      <button id="btn_clear_log" class="btn btn-sm btn-secondary">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="mt-4">
      <a href="test-03-edge-cases.html" class="btn btn-outline-secondary">[‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–µ—Å—Ç: –ö—Ä–∞–π–Ω–∏–µ —Å–ª—É—á–∞–∏]</a>
      <a href="test-05-arrays.html" class="btn btn-outline-primary ml-2">[–°–ª–µ–¥—É—é—â–∏–π —Ç–µ—Å—Ç: –ú–∞—Å—Å–∏–≤—ã –ø–æ–ª–µ–π ‚Üí]</a>
    </div>
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π -->
  <script type="module">
    import { FieldValidator } from '../../../modia/services/field-validator.js';
    import { FieldErrorRenderer } from '../../../modia/services/field-error-renderer.js';
    import { logger } from '../../../modia/services/logger.js';

    // ========================================================================
    // Mock Rules ‚Äî –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∫—Ä—ã—Ç—ã—Ö –ø–æ–ª–µ–π
    // ========================================================================
    const mockValidationRules = [
      {
        name: 'required',
        selector: '[required]',
        defaultMessage: '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ',
        validate($field, validator) {
          const value = validator.getFieldValue();
          const values = Array.isArray(value) ? value : [value];
          const hasFilledValue = values.some(val => val !== null && val !== undefined && val.trim() !== '');
          return hasFilledValue ? true : { valid: false, params: {} };
        }
      }
    ];

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let validators = {};
    let renderers = {};
    let autoTestRunning = false;

    // ========================================================================
    // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    // ========================================================================
    function log(message, type = 'info') {
      const $log = $('#console-log');
      const timestamp = new Date().toLocaleTimeString('ru-RU');
      const color = type === 'error' ? 'text-danger'
        : type === 'success' ? 'text-success'
          : type === 'warn' ? 'text-warning'
            : 'text-muted';
      $log.append(`<div class="${color}"><small>[${timestamp}] ${message}</small></div>`);
      $log.scrollTop($log[0].scrollHeight);
      console.log(`[FieldValidator Test] ${message}`);
    }

    // ========================================================================
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤
    // ========================================================================
    function initValidators() {
      // –°–µ–∫—Ü–∏—è 1: –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ + –≤–Ω–µ—à–Ω–∏–π —ç–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏
      const $valueSource1 = $('#character_id_1');
      const $errorScreen1 = $('#character-selector-1');
      renderers.h1 = new FieldErrorRenderer($errorScreen1);
      validators.h1 = new FieldValidator($valueSource1, $errorScreen1, $('#form-hidden-1'), mockValidationRules, renderers.h1);

      // –°–µ–∫—Ü–∏—è 2: –í–∏–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç + –≤–Ω–µ—à–Ω–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∑–Ω–∞—á–µ–Ω–∏—è
      const $valueSource2 = $('#visible-description');
      const $errorScreen2 = $('#visible-description');
      renderers.h2 = new FieldErrorRenderer($errorScreen2);
      validators.h2 = new FieldValidator($valueSource2, $errorScreen2, $('#form-hidden-2'), mockValidationRules, renderers.h2);

      // –°–µ–∫—Ü–∏—è 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
      const $valueSource3 = $('#test_field_3');
      const $errorScreen3 = $('#test-selector-3');
      renderers.h3 = new FieldErrorRenderer($errorScreen3);
      validators.h3 = new FieldValidator($valueSource3, $errorScreen3, $('#form-hidden-3'), mockValidationRules, renderers.h3);

      log('–í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã', 'success');
    }

    // ========================================================================
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –°–µ–∫—Ü–∏–∏ 1 (–í—ã–±–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞)
    // ========================================================================
    $('.character-btn[data-select]').on('click', function () {
      const $btn = $(this);
      const $container = $btn.closest('.character-selector');
      const value = $btn.data('select');

      // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
      $container.find('.character-btn').removeClass('selected');

      // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é
      $btn.addClass('selected');

      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ
      const hiddenInput = $container.siblings('input[type="hidden"]');
      if (hiddenInput.length) {
        hiddenInput.val(value);
        log(`–í—ã–±—Ä–∞–Ω –ø–µ—Ä—Å–æ–Ω–∞–∂: ${value}`, 'info');
      }
    });

    $('#btn_validate_h1').on('click', function () {
      const isValid = validators.h1.validate();
      const value = validators.h1.getFieldValue();
      $('#result_1')
        .removeClass('pending pass fail')
        .addClass(isValid ? 'pass' : 'fail')
        .text(`validate(): ${isValid} | value: "${value}"`);
      log(`–°–µ–∫—Ü–∏—è 1: validate() = ${isValid}, value = "${value}"`, isValid ? 'success' : 'error');
    });

    $('#btn_clear_h1').on('click', function () {
      validators.h1.clearError();
      $('#result_1').addClass('pass').text('–û—à–∏–±–∫–∞ –æ—á–∏—â–µ–Ω–∞');
      log('–°–µ–∫—Ü–∏—è 1: clearError()', 'info');
    });

    $('#btn_clear_selection_h1').on('click', function () {
      $('#character-selector-1 .character-btn').removeClass('selected');
      $('#character_id_1').val('');
      $('#result_1').addClass('pending').text('–í—ã–±—Ä–æ—Å –æ—á–∏—â–µ–Ω');
      log('–°–µ–∫—Ü–∏—è 1: –í—ã–±–æ—Ä –æ—á–∏—â–µ–Ω', 'info');
    });

    $('#btn_check_value_h1').on('click', function () {
      const value = validators.h1.getFieldValue();
      const $valueSource = validators.h1.$valueSource;
      const $errorScreen = validators.h1.$errorScreen;
      $('#result_1')
        .addClass('pass')
        .text(`$valueSource: ${$valueSource[0].tagName}#${$valueSource.attr('id')} | $errorScreen: ${$errorScreen[0].tagName}#${$errorScreen.attr('id')} | value: "${value}"`);
      log(`–°–µ–∫—Ü–∏—è 1: $valueSource=${$valueSource.attr('id')}, $errorScreen=${$errorScreen.attr('id')}, value="${value}"`, 'info');
    });

    // ========================================================================
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –°–µ–∫—Ü–∏–∏ 2 (–í–∏–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç + –≤–Ω–µ—à–Ω–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫)
    // ========================================================================
    $('#visible-description').on('input', function () {
      const text = $(this).text().trim();
      $('#hidden-description').val(text);
    });

    $('#btn_validate_h2').on('click', function () {
      const isValid = validators.h2.validate();
      const value = validators.h2.getFieldValue();
      $('#result_2')
        .removeClass('pending pass fail')
        .addClass(isValid ? 'pass' : 'fail')
        .text(`validate(): ${isValid} | value: "${value?.substring(0, 30)}..."`);
      log(`–°–µ–∫—Ü–∏—è 2: validate() = ${isValid}, value = "${value?.substring(0, 30)}..."`, isValid ? 'success' : 'error');
    });

    $('#btn_clear_h2').on('click', function () {
      validators.h2.clearError();
      $('#result_2').addClass('pass').text('–û—à–∏–±–∫–∞ –æ—á–∏—â–µ–Ω–∞');
      log('–°–µ–∫—Ü–∏—è 2: clearError()', 'info');
    });

    $('#btn_sync_value_h2').on('click', function () {
      const text = $('#visible-description').text().trim();
      $('#hidden-description').val(text);
      $('#result_2').addClass('pass').text(`–ó–Ω–∞—á–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: "${text.substring(0, 30)}..."`);
      log(`–°–µ–∫—Ü–∏—è 2: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: "${text.substring(0, 30)}..."`, 'info');
    });

    $('#btn_check_value_h2').on('click', function () {
      const value = validators.h2.getFieldValue();
      const $valueSource = validators.h2.$valueSource;
      const $errorScreen = validators.h2.$errorScreen;
      $('#result_2')
        .addClass('pass')
        .text(`$valueSource: ${$valueSource[0].tagName}#${$valueSource.attr('id')} | value: "${value?.substring(0, 30)}..."`);
      log(`–°–µ–∫—Ü–∏—è 2: $valueSource=${$valueSource.attr('id')}, value="${value?.substring(0, 30)}..."`, 'info');
    });

    // ========================================================================
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –°–µ–∫—Ü–∏–∏ 3 (–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
    // ========================================================================
    $('#btn_check_config_h3').on('click', function () {
      const $valueSource = validators.h3.$valueSource;
      const $errorScreen = validators.h3.$errorScreen;
      $('#result_3')
        .addClass('pass')
        .html(`
          <strong>$valueSource:</strong> ${$valueSource[0].tagName}#${$valueSource.attr('id')} (—Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ)<br>
          <strong>$errorScreen:</strong> ${$errorScreen[0].tagName}#${$errorScreen.attr('id')} (–≤–∏–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç)<br>
          <strong>–†–∞–∑–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:</strong> ${$valueSource[0] !== $errorScreen[0] ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}
        `);
      log(`–°–µ–∫—Ü–∏—è 3: $valueSource=${$valueSource.attr('id')}, $errorScreen=${$errorScreen.attr('id')}`, 'info');
    });

    $('#btn_validate_h3').on('click', function () {
      const isValid = validators.h3.validate();
      $('#result_3')
        .removeClass('pending pass fail')
        .addClass(isValid ? 'pass' : 'fail')
        .text(`validate(): ${isValid}`);
      log(`–°–µ–∫—Ü–∏—è 3: validate() = ${isValid}`, isValid ? 'success' : 'error');
    });

    // ========================================================================
    // –ê–≤—Ç–æ-—Ç–µ—Å—Ç
    // ========================================================================
    async function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function runAutoTestAll() {
      if (autoTestRunning) return;
      autoTestRunning = true;

      $('#auto_test_status').show();
      $('#auto_test_status_text').text('–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤...');

      log('=== –ó–ê–ü–£–°–ö –ê–í–¢–û-–¢–ï–°–¢–ê ===', 'info');

      // –°–µ–∫—Ü–∏—è 1: –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ + –≤–Ω–µ—à–Ω–∏–π —ç–∫—Ä–∞–Ω
      $('#auto_test_status_text').text('–°–µ–∫—Ü–∏—è 1: –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ...');
      $('#section_1').addClass('auto-test-running');
      await sleep(500);
      $('#character-selector-1 .character-btn[data-select="cheburashka"]').click();
      await sleep(300);
      $('#btn_validate_h1').click();
      await sleep(800);
      $('#btn_clear_selection_h1').click();
      await sleep(300);
      $('#btn_validate_h1').click();
      await sleep(800);
      $('#btn_check_value_h1').click();
      await sleep(500);
      $('#section_1').removeClass('auto-test-running');

      // –°–µ–∫—Ü–∏—è 2: –í–∏–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç + –≤–Ω–µ—à–Ω–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫
      $('#auto_test_status_text').text('–°–µ–∫—Ü–∏—è 2: –í–∏–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç...');
      $('#section_2').addClass('auto-test-running');
      await sleep(500);
      $('#visible-description').text('–¢–µ—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ');
      await sleep(300);
      $('#btn_sync_value_h2').click();
      await sleep(300);
      $('#btn_validate_h2').click();
      await sleep(800);
      $('#btn_check_value_h2').click();
      await sleep(500);
      $('#section_2').removeClass('auto-test-running');

      // –°–µ–∫—Ü–∏—è 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
      $('#auto_test_status_text').text('–°–µ–∫—Ü–∏—è 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
      $('#section_3').addClass('auto-test-running');
      await sleep(500);
      $('#btn_check_config_h3').click();
      await sleep(800);
      $('#btn_validate_h3').click();
      await sleep(500);
      $('#section_3').removeClass('auto-test-running');

      $('#auto_test_status_text').text('‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!');
      $('#auto_test_status').addClass('alert-success');
      log('=== –ê–í–¢–û-–¢–ï–°–¢ –ó–ê–í–ï–†–®–Å–ù ===', 'success');

      autoTestRunning = false;
    }

    $('#btn_auto_test_all').on('click', runAutoTestAll);

    $('#btn_stop_test').on('click', function () {
      autoTestRunning = false;
      $('#auto_test_status').hide();
      $('.auto-test-running').removeClass('auto-test-running');
      log('–ê–≤—Ç–æ—Ç–µ—Å—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º', 'warn');
    });

    $('#btn_clear_log').on('click', function () {
      $('#console-log').html('<div class="text-muted"><small>[00:00:00] –õ–æ–≥ –æ—á–∏—â–µ–Ω...</small></div>');
      log('–õ–æ–≥ –æ—á–∏—â–µ–Ω', 'info');
    });

    // ========================================================================
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    // ========================================================================
    $(document).ready(function () {
      initValidators();
      log('–¢–µ—Å—Ç FieldValidator –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'success');
    });
  </script>
</body>

</html>