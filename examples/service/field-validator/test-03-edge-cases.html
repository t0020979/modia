<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modia ‚Äî –¢–µ—Å—Ç FieldValidator (–ö—Ä–∞–π–Ω–∏–µ —Å–ª—É—á–∞–∏)</title>

  <!-- ‚úÖ jQuery CDN (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û) -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <!-- Bootstrap 4 CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <!-- ‚úÖ Modia CSS (—Å–∫—Ä—ã–≤–∞–µ—Ç .error-templates) -->
  <link rel="stylesheet" href="../../../modia/modia.css">

  <!-- –ü—Ä–∏–º–µ—Ä—ã CSS -->
  <link rel="stylesheet" href="../../../examples/examples.css">

  <style>
    .test-section {
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 20px;
      margin-bottom: 20px;
      background: #f8f9fa;
    }

    .instruction-box {
      background: #e7f3ff;
      border-left: 4px solid #007bff;
      padding: 10px;
      margin: 10px 0;
      font-size: 13px;
    }

    .console-log {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 4px;
      height: 200px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 20px;
    }

    .test-result {
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
    }

    .test-result.pass {
      background: #d4edda;
      color: #155724;
    }

    .test-result.fail {
      background: #f8d7da;
      color: #721c24;
    }

    .test-result.pending {
      background: #fff3cd;
      color: #856404;
    }

    .auto-test-running {
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% {
        opacity: 1;
      }

      50% {
        opacity: 0.6;
      }

      100% {
        opacity: 1;
      }
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è contenteditable —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ */
    .sql-editor {
      background: #f8f9fa;
      border: 1px solid #ced4da;
      border-radius: 4px;
      padding: 10px;
      min-height: 60px;
      font-family: 'Courier New', monospace;
    }

    .sql-keyword {
      color: #007bff;
      font-weight: bold;
    }

    .sql-string {
      color: #28a745;
    }
  </style>
</head>

<body>
  <div class="container mt-5">
    <h1>üß™ –¢–µ—Å—Ç FieldValidator Service</h1>
    <p class="lead">–ö—Ä–∞–π–Ω–∏–µ —Å–ª—É—á–∞–∏: contenteditable, no ID, disabled, multiple rules</p>

    <!-- –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div class="expected-result alert alert-info">
      <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
      <ul>
        <li><strong>Contenteditable:</strong> <code>getFieldValue()</code> –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–π —Ç–µ–∫—Å—Ç (–±–µ–∑
          HTML-—Ç–µ–≥–æ–≤ –ø–æ–¥—Å–≤–µ—Ç–∫–∏)</li>
        <li><strong>–ü–æ–ª–µ –±–µ–∑ ID:</strong> <code>logger.warn()</code> –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ ID, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç</li>
        <li><strong>–û—Ç–∫–ª—é—á—ë–Ω–Ω–æ–µ –ø–æ–ª–µ:</strong> <code>isVisibleForValidation()</code> ‚Üí <code>false</code>, –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
        </li>
        <li><strong>–ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª:</strong> –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø–æ –ø–æ—Ä—è–¥–∫—É, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ</li>
        <li><strong>–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π select:</strong> <code>getFieldValue()</code> ‚Üí <code>Array&lt;string&gt;</code></li>
      </ul>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 1: Contenteditable —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ -->
    <div class="test-section" id="section_1">
      <h3>üìç –°–µ–∫—Ü–∏—è 1: Contenteditable + –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞</h3>

      <div class="instruction-box">
        <strong>üìã –†—É—á–Ω–æ–π —Ç–µ—Å—Ç:</strong><br>
        1. –í–≤–µ–¥–∏—Ç–µ SQL: <code>SELECT * FROM users</code><br>
        2. –ù–∞–∂–º–∏—Ç–µ <code>üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</code><br>
        3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: <code>getFieldValue()</code> –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç (–±–µ–∑ &lt;span&gt;-—Ç–µ–≥–æ–≤)<br>
        4. –û—á–∏—Å—Ç–∏—Ç–µ –ø–æ–ª–µ, –Ω–∞–∂–º–∏—Ç–µ <code>üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</code> ‚Üí –æ—à–∏–±–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è
      </div>

      <form id="form-contenteditable" novalidate>
        <div class="form-group" id="fg-sql">
          <label>SQL –∑–∞–ø—Ä–æ—Å *</label>
          <div id="sql-editor" class="sql-editor" contenteditable="true" required>
            SELECT * FROM users;
          </div>
          <!-- –°–∫—Ä—ã—Ç—ã–π –∏–Ω–ø—É—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã -->
          <textarea class="d-none" name="sql_query"></textarea>
        </div>

        <div class="error-templates">
          <span class="text-danger" data-rule="required">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å</span>
        </div>
      </form>

      <div class="test-buttons mt-3">
        <button id="btn_validate_ce" class="btn btn-primary">üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="btn_clear_ce" class="btn btn-secondary">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É</button>
        <button id="btn_check_value_ce" class="btn btn-info">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</button>
        <button id="btn_add_highlight" class="btn btn-warning">‚ú® –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É (–∏–º–∏—Ç–∞—Ü–∏—è)</button>
      </div>

      <div id="result_1" class="test-result pending">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 2: –ü–æ–ª–µ –±–µ–∑ ID (logger.warn) -->
    <div class="test-section" id="section_2">
      <h3>üìç –°–µ–∫—Ü–∏—è 2: –ü–æ–ª–µ –±–µ–∑ ID –∞—Ç—Ä–∏–±—É—Ç–∞</h3>

      <div class="instruction-box">
        <strong>üìã –†—É—á–Ω–æ–π —Ç–µ—Å—Ç:</strong><br>
        1. –ù–∞–∂–º–∏—Ç–µ <code>üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</code><br>
        2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å <code>logger.warn()</code> –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ ID<br>
        3. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–≤–æ–∑–≤—Ä–∞—â–∞—Ç—å false –¥–ª—è –ø—É—Å—Ç–æ–≥–æ –ø–æ–ª—è)
      </div>

      <form id="form-no-id" novalidate>
        <div class="form-group" id="fg-no-id">
          <label>–ü–æ–ª–µ –±–µ–∑ ID *</label>
          <input type="text" name="no_id_field" required class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç">
        </div>

        <div class="error-templates">
          <span class="text-danger" data-rule="required">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</span>
        </div>
      </form>

      <div class="test-buttons mt-3">
        <button id="btn_validate_noid" class="btn btn-primary">üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="btn_clear_noid" class="btn btn-secondary">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É</button>
        <button id="btn_check_log_noid" class="btn btn-info">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ (warn)</button>
      </div>

      <div id="result_2" class="test-result pending">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 3: –û—Ç–∫–ª—é—á—ë–Ω–Ω–æ–µ –ø–æ–ª–µ -->
    <div class="test-section" id="section_3">
      <h3>üìç –°–µ–∫—Ü–∏—è 3: –û—Ç–∫–ª—é—á—ë–Ω–Ω–æ–µ –ø–æ–ª–µ (disabled)</h3>

      <div class="instruction-box">
        <strong>üìã –†—É—á–Ω–æ–π —Ç–µ—Å—Ç:</strong><br>
        1. –ù–∞–∂–º–∏—Ç–µ <code>üëÅÔ∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å</code> ‚Üí –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å <code>false</code><br>
        2. –ù–∞–∂–º–∏—Ç–µ <code>üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</code> ‚Üí –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å <code>true</code> (–ø–æ–ª–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è)<br>
        3. –ù–∞–∂–º–∏—Ç–µ <code>üîß –í–∫–ª—é—á–∏—Ç—å –ø–æ–ª–µ</code>, –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ —Ç–µ—Å—Ç
      </div>

      <form id="form-disabled" novalidate>
        <div class="form-group" id="fg-disabled">
          <label>–û—Ç–∫–ª—é—á—ë–Ω–Ω–æ–µ –ø–æ–ª–µ *</label>
          <input type="text" id="disabled-field" name="disabled_field" required class="form-control" disabled>
        </div>

        <div class="error-templates">
          <span class="text-danger" data-rule="required">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</span>
        </div>
      </form>

      <div class="test-buttons mt-3">
        <button id="btn_check_visible_dis" class="btn btn-primary">üëÅÔ∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å</button>
        <button id="btn_validate_dis" class="btn btn-secondary">üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="btn_toggle_dis" class="btn btn-warning">üîß –í–∫–ª—é—á–∏—Ç—å/–û—Ç–∫–ª—é—á–∏—Ç—å –ø–æ–ª–µ</button>
      </div>

      <div id="result_3" class="test-result pending">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 4: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª -->
    <div class="test-section" id="section_4">
      <h3>üìç –°–µ–∫—Ü–∏—è 4: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª (required + max-length)</h3>

      <div class="instruction-box">
        <strong>üìã –†—É—á–Ω–æ–π —Ç–µ—Å—Ç:</strong><br>
        1. –û—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–µ –ø—É—Å—Ç—ã–º ‚Üí –æ—à–∏–±–∫–∞ "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ"<br>
        2. –í–≤–µ–¥–∏—Ç–µ 100 —Å–∏–º–≤–æ–ª–æ–≤ ‚Üí –æ—à–∏–±–∫–∞ "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 50"<br>
        3. –í–≤–µ–¥–∏—Ç–µ "OK" ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
      </div>

      <form id="form-multi-rules" novalidate>
        <div class="form-group" id="fg-multi">
          <label>–û–ø–∏—Å–∞–Ω–∏–µ * (–º–∞–∫—Å. 50 —Å–∏–º–≤–æ–ª–æ–≤)</label>
          <input type="text" id="desc-field" name="description" required data-max-length="50" class="form-control"
            maxlength="50">
          <small class="form-text text-muted">–ú–∞–∫—Å–∏–º—É–º 50 —Å–∏–º–≤–æ–ª–æ–≤</small>
        </div>

        <div class="error-templates">
          <span class="text-danger" data-rule="required">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</span>
          <span class="text-danger" data-rule="max-length">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: __count__ —Å–∏–º–≤–æ–ª–æ–≤</span>
        </div>
      </form>

      <div class="test-buttons mt-3">
        <button id="btn_validate_multi" class="btn btn-primary">üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="btn_clear_multi" class="btn btn-secondary">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É</button>
        <button id="btn_fill_100" class="btn btn-info">‚úçÔ∏è –ó–∞–ø–æ–ª–Ω–∏—Ç—å 100 —Å–∏–º–≤–æ–ª–æ–≤</button>
        <button id="btn_fill_ok" class="btn btn-success">‚úÖ –ó–∞–ø–æ–ª–Ω–∏—Ç—å "OK"</button>
      </div>

      <div id="result_4" class="test-result pending">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 5: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π select -->
    <div class="test-section" id="section_5">
      <h3>üìç –°–µ–∫—Ü–∏—è 5: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π select (Array<string>)</h3>

      <div class="instruction-box">
        <strong>üìã –†—É—á–Ω–æ–π —Ç–µ—Å—Ç:</strong><br>
        1. –í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤<br>
        2. –ù–∞–∂–º–∏—Ç–µ <code>üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</code> ‚Üí –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å <code>Array&lt;string&gt;</code><br>
        3. –ù–∞–∂–º–∏—Ç–µ <code>üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</code> ‚Üí –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å <code>true</code> (—Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤—ã–±—Ä–∞–Ω)
      </div>

      <form id="form-multi-select" novalidate>
        <div class="form-group" id="fg-select">
          <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–≥–∏ * (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)</label>
          <select id="tags-select" name="tags[]" multiple required class="form-control" size="4">
            <option value="tag1">–¢–µ–≥ 1</option>
            <option value="tag2">–¢–µ–≥ 2</option>
            <option value="tag3">–¢–µ–≥ 3</option>
            <option value="tag4">–¢–µ–≥ 4</option>
          </select>
          <small class="form-text text-muted">–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ Ctrl/Cmd –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö</small>
        </div>

        <div class="error-templates">
          <span class="text-danger" data-rule="required">–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–µ–≥</span>
        </div>
      </form>

      <div class="test-buttons mt-3">
        <button id="btn_check_value_select" class="btn btn-info">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</button>
        <button id="btn_validate_select" class="btn btn-primary">üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="btn_clear_select" class="btn btn-secondary">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É</button>
      </div>

      <div id="result_5" class="test-result pending">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –∞–≤—Ç–æ-—Ç–µ—Å—Ç–∞ -->
    <div class="test-buttons mt-4">
      <button id="btn_auto_test_all" class="btn btn-success btn-lg">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ-—Ç–µ—Å—Ç –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π</button>
      <button id="btn_stop_test" class="btn btn-danger btn-lg">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
    </div>

    <div id="auto_test_status" class="alert alert-info mt-3" style="display: none;">
      –°—Ç–∞—Ç—É—Å: <span id="auto_test_status_text">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
    </div>

    <!-- –ö–æ–Ω—Å–æ–ª—å –ª–æ–≥ -->
    <div class="console-log" id="console-log">
      <div class="text-muted"><small>[00:00:00] –ö–æ–Ω—Å–æ–ª—å –ª–æ–≥–≥–µ—Ä–∞ –≥–æ—Ç–æ–≤–∞...</small></div>
    </div>

    <div class="test-buttons mt-2">
      <button id="btn_clear_log" class="btn btn-sm btn-secondary">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
      <button id="btn_count_warn" class="btn btn-sm btn-warning">‚ö†Ô∏è –ü–æ—Å—á–∏—Ç–∞—Ç—å warn</button>
      <button id="btn_count_error" class="btn btn-sm btn-danger">‚ùå –ü–æ—Å—á–∏—Ç–∞—Ç—å error</button>
    </div>

    <div id="log_stats" class="alert alert-secondary mt-2" style="display: none;">
      <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–æ–≥–æ–≤:</strong><br>
      Warn: <span id="warn_count">0</span> | Error: <span id="error_count">0</span>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="mt-4">
      <a href="test-02-message-hierarchy.html" class="btn btn-outline-secondary">[‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–µ—Å—Ç: –ò–µ—Ä–∞—Ä—Ö–∏—è
        —Å–æ–æ–±—â–µ–Ω–∏–π]</a>
      <a href="test-04-hidden-fields.html" class="btn btn-outline-primary ml-2">[–°–ª–µ–¥—É—é—â–∏–π —Ç–µ—Å—Ç: –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è ‚Üí]</a>
    </div>
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π -->
  <script type="module">
    import { FieldValidator } from '../../../modia/services/field-validator.js';
    import { FieldErrorRenderer } from '../../../modia/services/field-error-renderer.js';
    import { logger } from '../../../modia/services/logger.js';

    // ========================================================================
    // Mock Rules ‚Äî –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫—Ä–∞–π–Ω–∏—Ö —Å–ª—É—á–∞–µ–≤
    // ========================================================================
    const mockValidationRules = [
      {
        name: 'required',
        selector: '[required]',
        defaultMessage: '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ',
        validate($field, validator) {
          const value = validator.getFieldValue();
          const values = Array.isArray(value) ? value : [value];
          const hasFilledValue = values.some(val => val !== null && val !== undefined && val.trim() !== '');
          return hasFilledValue ? true : { valid: false, params: {} };
        }
      },
      {
        name: 'max-length',
        selector: '[data-max-length]',
        defaultMessage: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: __Count__ —Å–∏–º–≤–æ–ª–æ–≤',
        validate($field, validator) {
          const maxLength = parseInt($field.data('max-length'), 10);
          const value = validator.getFieldValue();
          const values = Array.isArray(value) ? value : [value];
          const allValid = values.every(val => val.length <= maxLength);
          return allValid ? true : { valid: false, params: { count: maxLength } };
        }
      }
    ];

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let validators = {};
    let renderers = {};
    let autoTestRunning = false;
    let warnCount = 0;
    let errorCount = 0;

    // ========================================================================
    // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è + –ø–µ—Ä–µ—Ö–≤–∞—Ç –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞
    // ========================================================================
    function log(message, type = 'info') {
      const $log = $('#console-log');
      const timestamp = new Date().toLocaleTimeString('ru-RU');
      const color = type === 'error' ? 'text-danger'
        : type === 'success' ? 'text-success'
          : type === 'warn' ? 'text-warning'
            : 'text-muted';
      $log.append(`<div class="${color}"><small>[${timestamp}] ${message}</small></div>`);
      $log.scrollTop($log[0].scrollHeight);
      console.log(`[FieldValidator Test] ${message}`);

      if (type === 'warn') warnCount++;
      if (type === 'error') errorCount++;
    }

    // –ü–µ—Ä–µ—Ö–≤–∞—Ç –ª–æ–≥–æ–≤ –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞
    const originalWarn = logger.warn.bind(logger);
    const originalError = logger.error.bind(logger);

    logger.warn = function (message, context) {
      warnCount++;
      originalWarn(message, context);
    };

    logger.error = function (message, context) {
      errorCount++;
      originalError(message, context);
    };

    // ========================================================================
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤
    // ========================================================================
    function initValidators() {
      // –°–µ–∫—Ü–∏—è 1: Contenteditable
      const $sql = $('#sql-editor');
      renderers.ce = new FieldErrorRenderer($sql);
      validators.ce = new FieldValidator($sql, $sql, $('#form-contenteditable'), mockValidationRules, renderers.ce);

      // –°–µ–∫—Ü–∏—è 2: –ü–æ–ª–µ –±–µ–∑ ID
      const $noId = $('input[name="no_id_field"]');
      renderers.noid = new FieldErrorRenderer($noId);
      validators.noid = new FieldValidator($noId, $noId, $('#form-no-id'), mockValidationRules, renderers.noid);

      // –°–µ–∫—Ü–∏—è 3: –û—Ç–∫–ª—é—á—ë–Ω–Ω–æ–µ –ø–æ–ª–µ
      const $dis = $('#disabled-field');
      renderers.dis = new FieldErrorRenderer($dis);
      validators.dis = new FieldValidator($dis, $dis, $('#form-disabled'), mockValidationRules, renderers.dis);

      // –°–µ–∫—Ü–∏—è 4: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª
      const $multi = $('#desc-field');
      renderers.multi = new FieldErrorRenderer($multi);
      validators.multi = new FieldValidator($multi, $multi, $('#form-multi-rules'), mockValidationRules, renderers.multi);

      // –°–µ–∫—Ü–∏—è 5: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π select
      const $select = $('#tags-select');
      renderers.select = new FieldErrorRenderer($select);
      validators.select = new FieldValidator($select, $select, $('#form-multi-select'), mockValidationRules, renderers.select);

      log('–í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã', 'success');
    }

    // ========================================================================
    // –°–µ–∫—Ü–∏—è 1: Contenteditable
    // ========================================================================
    $('#btn_validate_ce').on('click', function () {
      const isValid = validators.ce.validate();
      const value = validators.ce.getFieldValue();
      $('#result_1')
        .removeClass('pending pass fail')
        .addClass(isValid ? 'pass' : 'fail')
        .text(`validate(): ${isValid} | getFieldValue(): "${value}"`);
      log(`Contenteditable: validate() = ${isValid}, value = "${value}"`, isValid ? 'success' : 'error');
    });

    $('#btn_clear_ce').on('click', function () {
      validators.ce.clearError();
      $('#result_1').addClass('pass').text('–û—à–∏–±–∫–∞ –æ—á–∏—â–µ–Ω–∞');
      log('Contenteditable: clearError()', 'info');
    });

    $('#btn_check_value_ce').on('click', function () {
      const value = validators.ce.getFieldValue();
      const hasHtml = $('#sql-editor').html().includes('<');
      $('#result_1').addClass('pass').text(`getFieldValue(): "${value}" ${hasHtml ? '(HTML –≤ DOM, –Ω–æ –Ω–µ –≤ –∑–Ω–∞—á–µ–Ω–∏–∏)' : ''}`);
      log(`Contenteditable value: "${value}" (DOM has HTML: ${hasHtml})`, 'info');
    });

    $('#btn_add_highlight').on('click', function () {
      // –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞: –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ span
      const $editor = $('#sql-editor');
      let html = $editor.html();
      html = html.replace(/SELECT/gi, '<span class="sql-keyword">SELECT</span>');
      html = html.replace(/FROM/gi, '<span class="sql-keyword">FROM</span>');
      html = html.replace(/users/gi, '<span class="sql-string">users</span>');
      $editor.html(html);
      log('–î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–º–∏—Ç–∞—Ü–∏—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ (HTML-—Ç–µ–≥–∏ –≤ DOM)', 'info');
    });

    // ========================================================================
    // –°–µ–∫—Ü–∏—è 2: –ü–æ–ª–µ –±–µ–∑ ID
    // ========================================================================
    $('#btn_validate_noid').on('click', function () {
      const isValid = validators.noid.validate();
      $('#result_2')
        .removeClass('pending pass fail')
        .addClass(isValid ? 'pass' : 'fail')
        .text(`validate(): ${isValid}`);
      log(`No-ID field: validate() = ${isValid}`, isValid ? 'success' : 'error');
    });

    $('#btn_clear_noid').on('click', function () {
      validators.noid.clearError();
      $('#result_2').addClass('pass').text('–û—à–∏–±–∫–∞ –æ—á–∏—â–µ–Ω–∞');
      log('No-ID field: clearError()', 'info');
    });

    $('#btn_check_log_noid').on('click', function () {
      $('#log_stats').show();
      $('#warn_count').text(warnCount);
      $('#error_count').text(errorCount);
      log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤: warn=${warnCount}, error=${errorCount}`, 'info');
    });

    // ========================================================================
    // –°–µ–∫—Ü–∏—è 3: –û—Ç–∫–ª—é—á—ë–Ω–Ω–æ–µ –ø–æ–ª–µ
    // ========================================================================
    $('#btn_check_visible_dis').on('click', function () {
      const isVisible = validators.dis.isVisibleForValidation();
      $('#result_3')
        .removeClass('pending pass fail')
        .addClass(isVisible ? 'pass' : 'fail')
        .text(`isVisibleForValidation(): ${isVisible}`);
      log(`Disabled field: isVisibleForValidation() = ${isVisible}`, isVisible ? 'success' : 'warn');
    });

    $('#btn_validate_dis').on('click', function () {
      const isValid = validators.dis.validate();
      $('#result_3')
        .removeClass('pending pass fail')
        .addClass('pass')
        .text(`validate(): ${isValid} (–æ—Ç–∫–ª—é—á—ë–Ω–Ω–æ–µ –ø–æ–ª–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è)`);
      log(`Disabled field: validate() = ${isValid} (–ø—Ä–æ–ø—É—â–µ–Ω–æ)`, 'success');
    });

    $('#btn_toggle_dis').on('click', function () {
      const $field = $('#disabled-field');
      const isDisabled = $field.prop('disabled');
      $field.prop('disabled', !isDisabled);
      log(`–ü–æ–ª–µ ${isDisabled ? '–≤–∫–ª—é—á–µ–Ω–æ' : '–æ—Ç–∫–ª—é—á–µ–Ω–æ'}`, 'info');
    });

    // ========================================================================
    // –°–µ–∫—Ü–∏—è 4: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª
    // ========================================================================
    $('#btn_validate_multi').on('click', function () {
      const isValid = validators.multi.validate();
      $('#result_4')
        .removeClass('pending pass fail')
        .addClass(isValid ? 'pass' : 'fail')
        .text(`validate(): ${isValid}`);
      log(`Multi-rules: validate() = ${isValid}`, isValid ? 'success' : 'error');
    });

    $('#btn_clear_multi').on('click', function () {
      validators.multi.clearError();
      $('#result_4').addClass('pass').text('–û—à–∏–±–∫–∞ –æ—á–∏—â–µ–Ω–∞');
      log('Multi-rules: clearError()', 'info');
    });

    $('#btn_fill_100').on('click', function () {
      $('#desc-field').val('A'.repeat(100));
      log('–ó–∞–ø–æ–ª–Ω–µ–Ω–æ 100 —Å–∏–º–≤–æ–ª–æ–≤ (–ø—Ä–µ–≤—ã—à–∞–µ—Ç max-length: 50)', 'info');
    });

    $('#btn_fill_ok').on('click', function () {
      $('#desc-field').val('OK');
      log('–ó–∞–ø–æ–ª–Ω–µ–Ω–æ "OK" (–≤–∞–ª–∏–¥–Ω–æ)', 'info');
    });

    // ========================================================================
    // –°–µ–∫—Ü–∏—è 5: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π select
    // ========================================================================
    $('#btn_check_value_select').on('click', function () {
      const value = validators.select.getFieldValue();
      const isArray = Array.isArray(value);
      $('#result_5')
        .removeClass('pending pass fail')
        .addClass('pass')
        .text(`getFieldValue(): ${JSON.stringify(value)} (type: ${isArray ? 'Array' : 'string'})`);
      log(`Multi-select value: ${JSON.stringify(value)} (${isArray ? 'Array' : 'string'})`, 'info');
    });

    $('#btn_validate_select').on('click', function () {
      const isValid = validators.select.validate();
      $('#result_5')
        .removeClass('pending pass fail')
        .addClass(isValid ? 'pass' : 'fail')
        .text(`validate(): ${isValid}`);
      log(`Multi-select: validate() = ${isValid}`, isValid ? 'success' : 'error');
    });

    $('#btn_clear_select').on('click', function () {
      validators.select.clearError();
      $('#result_5').addClass('pass').text('–û—à–∏–±–∫–∞ –æ—á–∏—â–µ–Ω–∞');
      log('Multi-select: clearError()', 'info');
    });

    // ========================================================================
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–æ–≥–æ–≤
    // ========================================================================
    $('#btn_count_warn').on('click', function () {
      $('#log_stats').show();
      $('#warn_count').text(warnCount);
      log(`warn count: ${warnCount}`, 'info');
    });

    $('#btn_count_error').on('click', function () {
      $('#log_stats').show();
      $('#error_count').text(errorCount);
      log(`error count: ${errorCount}`, 'info');
    });

    // ========================================================================
    // –ê–≤—Ç–æ-—Ç–µ—Å—Ç
    // ========================================================================
    async function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function runAutoTestAll() {
      if (autoTestRunning) return;
      autoTestRunning = true;

      $('#auto_test_status').show();
      $('#auto_test_status_text').text('–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤...');

      log('=== –ó–ê–ü–£–°–ö –ê–í–¢–û-–¢–ï–°–¢–ê ===', 'info');

      // –°–µ–∫—Ü–∏—è 1: Contenteditable
      $('#auto_test_status_text').text('–°–µ–∫—Ü–∏—è 1: Contenteditable...');
      $('#section_1').addClass('auto-test-running');
      await sleep(500);
      $('#btn_validate_ce').click();
      await sleep(800);
      $('#btn_add_highlight').click();
      await sleep(300);
      $('#btn_check_value_ce').click();
      await sleep(500);
      $('#section_1').removeClass('auto-test-running');

      // –°–µ–∫—Ü–∏—è 2: No ID
      $('#auto_test_status_text').text('–°–µ–∫—Ü–∏—è 2: –ü–æ–ª–µ –±–µ–∑ ID...');
      $('#section_2').addClass('auto-test-running');
      await sleep(500);
      $('#btn_validate_noid').click();
      await sleep(800);
      $('#btn_check_log_noid').click();
      await sleep(500);
      $('#section_2').removeClass('auto-test-running');

      // –°–µ–∫—Ü–∏—è 3: Disabled
      $('#auto_test_status_text').text('–°–µ–∫—Ü–∏—è 3: –û—Ç–∫–ª—é—á—ë–Ω–Ω–æ–µ –ø–æ–ª–µ...');
      $('#section_3').addClass('auto-test-running');
      await sleep(500);
      $('#btn_check_visible_dis').click();
      await sleep(800);
      $('#btn_validate_dis').click();
      await sleep(500);
      $('#section_3').removeClass('auto-test-running');

      // –°–µ–∫—Ü–∏—è 4: Multiple rules
      $('#auto_test_status_text').text('–°–µ–∫—Ü–∏—è 4: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª...');
      $('#section_4').addClass('auto-test-running');
      await sleep(500);
      $('#btn_validate_multi').click();
      await sleep(800);
      $('#btn_fill_100').click();
      await sleep(300);
      $('#btn_validate_multi').click();
      await sleep(800);
      $('#btn_fill_ok').click();
      await sleep(300);
      $('#btn_validate_multi').click();
      await sleep(500);
      $('#section_4').removeClass('auto-test-running');

      // –°–µ–∫—Ü–∏—è 5: Multi-select
      $('#auto_test_status_text').text('–°–µ–∫—Ü–∏—è 5: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π select...');
      $('#section_5').addClass('auto-test-running');
      await sleep(500);
      $('#tags-select').val(['tag1', 'tag3']);
      await sleep(300);
      $('#btn_check_value_select').click();
      await sleep(800);
      $('#btn_validate_select').click();
      await sleep(500);
      $('#section_5').removeClass('auto-test-running');

      $('#auto_test_status_text').text('‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!');
      $('#auto_test_status').addClass('alert-success');
      log('=== –ê–í–¢–û-–¢–ï–°–¢ –ó–ê–í–ï–†–®–Å–ù ===', 'success');

      autoTestRunning = false;
    }

    $('#btn_auto_test_all').on('click', runAutoTestAll);

    $('#btn_stop_test').on('click', function () {
      autoTestRunning = false;
      $('#auto_test_status').hide();
      $('.auto-test-running').removeClass('auto-test-running');
      log('–ê–≤—Ç–æ—Ç–µ—Å—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º', 'warn');
    });

    $('#btn_clear_log').on('click', function () {
      $('#console-log').html('<div class="text-muted"><small>[00:00:00] –õ–æ–≥ –æ—á–∏—â–µ–Ω...</small></div>');
      warnCount = 0;
      errorCount = 0;
      $('#log_stats').hide();
      log('–õ–æ–≥ –æ—á–∏—â–µ–Ω', 'info');
    });

    // ========================================================================
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    // ========================================================================
    $(document).ready(function () {
      initValidators();
      log('–¢–µ—Å—Ç FieldValidator –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'success');
    });
  </script>
</body>

</html>