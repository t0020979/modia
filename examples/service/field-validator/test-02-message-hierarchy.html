<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modia ‚Äî –¢–µ—Å—Ç FieldValidator (–ò–µ—Ä–∞—Ä—Ö–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π)</title>

  <!-- ‚úÖ jQuery CDN (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û) -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <!-- Bootstrap 4 CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <!-- ‚úÖ Modia CSS (—Å–∫—Ä—ã–≤–∞–µ—Ç .error-templates) -->
  <link rel="stylesheet" href="../../../modia/modia.css">

  <!-- –ü—Ä–∏–º–µ—Ä—ã CSS -->
  <link rel="stylesheet" href="../../../examples/examples.css">

  <style>
    .test-section {
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 20px;
      margin-bottom: 20px;
      background: #f8f9fa;
    }

    .instruction-box {
      background: #e7f3ff;
      border-left: 4px solid #007bff;
      padding: 10px;
      margin: 10px 0;
      font-size: 13px;
    }

    .console-log {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 4px;
      height: 200px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 20px;
    }

    .test-result {
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
    }

    .test-result.pass {
      background: #d4edda;
      color: #155724;
    }

    .test-result.fail {
      background: #f8d7da;
      color: #721c24;
    }

    .test-result.pending {
      background: #fff3cd;
      color: #856404;
    }

    .auto-test-running {
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% {
        opacity: 1;
      }

      50% {
        opacity: 0.6;
      }

      100% {
        opacity: 1;
      }
    }

    .level-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 3px;
      font-size: 11px;
      font-weight: bold;
      margin-left: 5px;
    }

    .level-1 {
      background: #28a745;
      color: white;
    }

    .level-2 {
      background: #17a2b8;
      color: white;
    }

    .level-3 {
      background: #ffc107;
      color: #212529;
    }

    .level-4 {
      background: #fd7e14;
      color: white;
    }

    .level-5 {
      background: #dc3545;
      color: white;
    }
  </style>
</head>

<body data-modia-log>
  <div class="container mt-5">
    <h1>üß™ –¢–µ—Å—Ç FieldValidator Service</h1>
    <p class="lead">5 —É—Ä–æ–≤–Ω–µ–π –∏–µ—Ä–∞—Ä—Ö–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</p>

    <!-- –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div class="expected-result alert alert-info">
      <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
      <ul>
        <li><strong>–£—Ä–æ–≤–µ–Ω—å 1:</strong> <code>data-error-text-{rule}</code> ‚Üí –±–µ–∑ –ª–æ–≥–æ–≤</li>
        <li><strong>–£—Ä–æ–≤–µ–Ω—å 2:</strong> <code>.error-templates [data-rule]</code> ‚Üí –±–µ–∑ –ª–æ–≥–æ–≤</li>
        <li><strong>–£—Ä–æ–≤–µ–Ω—å 3:</strong> –û—Ç–¥–µ–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω (<code>#error_span</code>) ‚Üí <code>logger.warn()</code></li>
        <li><strong>–£—Ä–æ–≤–µ–Ω—å 4:</strong> <code>rule.defaultMessage</code> ‚Üí <code>logger.error()</code></li>
        <li><strong>–£—Ä–æ–≤–µ–Ω—å 5:</strong> Fallback ‚Üí <code>logger.error()</code> (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞)</li>
        <li>–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –∏ HTML-–ª–æ–≥</li>
      </ul>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 1: –£—Ä–æ–≤–µ–Ω—å 1 (Inline-–∞—Ç—Ä–∏–±—É—Ç) -->
    <div class="test-section" id="section_1">
      <h3>üìç –°–µ–∫—Ü–∏—è 1: –£—Ä–æ–≤–µ–Ω—å 1 ‚Äî Inline-–∞—Ç—Ä–∏–±—É—Ç <span class="level-badge level-1">L1</span></h3>

      <div class="instruction-box">
        <strong>üìã –†—É—á–Ω–æ–π —Ç–µ—Å—Ç:</strong><br>
        1. –ù–∞–∂–º–∏—Ç–µ <code>üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</code><br>
        2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: ¬´–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ email¬ª<br>
        3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥: <strong>–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å</strong> warn/error
      </div>

      <form id="form-level-1" >
        <div class="form-group">
          <label>Email *</label>
          <input type="text" id="email-l1" name="email" required class="form-control"
            data-error-text-required="–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ email">
        </div>

        <div class="error-templates">
          <span class="text-danger" data-rule="required">–®–∞–±–ª–æ–Ω —É—Ä–æ–≤–Ω—è 2</span>
        </div>
      </form>

      <div class="test-buttons mt-3">
        <button type="submit" id="btn_validate_l1" class="btn btn-primary">üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="btn_clear_l1" class="btn btn-secondary">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É</button>
      </div>

      <div id="result_1" class="test-result pending">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 2: –£—Ä–æ–≤–µ–Ω—å 2 (–®–∞–±–ª–æ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ) -->
    <div class="test-section" id="section_2">
      <h3>üìç –°–µ–∫—Ü–∏—è 2: –£—Ä–æ–≤–µ–Ω—å 2 ‚Äî –®–∞–±–ª–æ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ <span class="level-badge level-2">L2</span></h3>

      <div class="instruction-box">
        <strong>üìã –†—É—á–Ω–æ–π —Ç–µ—Å—Ç:</strong><br>
        1. –ù–∞–∂–º–∏—Ç–µ <code>üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</code><br>
        2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: ¬´–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ (—É—Ä–æ–≤–µ–Ω—å 2)¬ª<br>
        3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥: <strong>–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å</strong> warn/error
      </div>

      <form id="form-level-2" >
        <div class="form-group">
          <label>–¢–µ–ª–µ—Ñ–æ–Ω *</label>
          <input type="text" id="phone-l2" name="phone" required class="form-control">
        </div>

        <div class="error-templates">
          <span class="text-danger" data-rule="required">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ (—É—Ä–æ–≤–µ–Ω—å 2)</span>
        </div>
      </form>

      <div class="test-buttons mt-3">
        <button id="btn_validate_l2" class="btn btn-primary">üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="btn_clear_l2" class="btn btn-secondary">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É</button>
      </div>

      <div id="result_2" class="test-result pending">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 3: –£—Ä–æ–≤–µ–Ω—å 3 (–û—Ç–¥–µ–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω) -->
    <div class="test-section" id="section_3">
      <h3>üìç –°–µ–∫—Ü–∏—è 3: –£—Ä–æ–≤–µ–Ω—å 3 ‚Äî –û—Ç–¥–µ–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω <span class="level-badge level-3">L3</span></h3>

      <div class="instruction-box">
        <strong>üìã –†—É—á–Ω–æ–π —Ç–µ—Å—Ç:</strong><br>
        1. –ù–∞–∂–º–∏—Ç–µ <code>üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</code><br>
        2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: ¬´–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ (legacy)¬ª<br>
        3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥: <strong>–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å</strong> <code>logger.warn()</code> –æ –º–∏–≥—Ä–∞—Ü–∏–∏
      </div>

      <form id="form-level-3" >
        <div class="form-group">
          <label>–ò–º—è *</label>
          <input type="text" id="name-l3" name="name" required class="form-control">
        </div>

        <!-- –û—Ç–¥–µ–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω (—É—Ä–æ–≤–µ–Ω—å 3) -->
        <div class="invisible" id="error_span">
          <span class="text-danger">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ (legacy)</span>
        </div>
      </form>

      <div class="test-buttons mt-3">
        <button id="btn_validate_l3" class="btn btn-primary">üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="btn_clear_l3" class="btn btn-secondary">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É</button>
        <button id="btn_check_log_l3" class="btn btn-info">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥ (warn)</button>
      </div>

      <div id="result_3" class="test-result pending">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 4: –£—Ä–æ–≤–µ–Ω—å 4 (–°–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –ø—Ä–∞–≤–∏–ª–∞) -->
    <div class="test-section" id="section_4">
      <h3>üìç –°–µ–∫—Ü–∏—è 4: –£—Ä–æ–≤–µ–Ω—å 4 ‚Äî –°–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –ø—Ä–∞–≤–∏–ª–∞ <span class="level-badge level-4">L4</span></h3>

      <div class="instruction-box">
        <strong>üìã –†—É—á–Ω–æ–π —Ç–µ—Å—Ç:</strong><br>
        1. –ù–∞–∂–º–∏—Ç–µ <code>üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</code><br>
        2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: ¬´This field is required¬ª<br>
        3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥: <strong>–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å</strong> <code>logger.error()</code>
      </div>

      <form id="form-level-4" >
        <div class="form-group">
          <label>–ü–∞—Ä–æ–ª—å *</label>
          <input type="text" id="password-l4" name="password" required class="form-control">
        </div>

        <!-- –ù–µ—Ç —à–∞–±–ª–æ–Ω–æ–≤ ‚Üí —É—Ä–æ–≤–µ–Ω—å 4 -->
      </form>

      <div class="test-buttons mt-3">
        <button id="btn_validate_l4" class="btn btn-primary">üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="btn_clear_l4" class="btn btn-secondary">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É</button>
        <button id="btn_check_log_l4" class="btn btn-info">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥ (error)</button>
      </div>

      <div id="result_4" class="test-result pending">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è 5: –£—Ä–æ–≤–µ–Ω—å 5 (Fallback) -->
    <div class="test-section" id="section_5">
      <h3>üìç –°–µ–∫—Ü–∏—è 5: –£—Ä–æ–≤–µ–Ω—å 5 ‚Äî Fallback <span class="level-badge level-5">L5</span></h3>

      <div class="instruction-box">
        <strong>üìã –†—É—á–Ω–æ–π —Ç–µ—Å—Ç:</strong><br>
        1. –ù–∞–∂–º–∏—Ç–µ <code>üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</code><br>
        2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: ¬´Field error¬ª<br>
        3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥: <strong>–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å</strong> <code>logger.error()</code> (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞)
      </div>

      <form id="form-level-5" >
        <div class="form-group">
          <label>–ö–æ–¥ *</label>
          <input type="text" id="code-l5" name="code" required class="form-control" data-custom-rule="true">
        </div>

        <!-- –ù–µ—Ç —à–∞–±–ª–æ–Ω–æ–≤, –Ω–µ—Ç defaultMessage ‚Üí —É—Ä–æ–≤–µ–Ω—å 5 -->
      </form>

      <div class="test-buttons mt-3">
        <button id="btn_validate_l5" class="btn btn-primary">üìù –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="btn_clear_l5" class="btn btn-secondary">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É</button>
        <button id="btn_check_log_l5" class="btn btn-info">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥ (critical)</button>
      </div>

      <div id="result_5" class="test-result pending">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –∞–≤—Ç–æ-—Ç–µ—Å—Ç–∞ -->
    <div class="test-buttons mt-4">
      <button id="btn_auto_test_all" class="btn btn-success btn-lg">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ-—Ç–µ—Å—Ç –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π</button>
      <button id="btn_stop_test" class="btn btn-danger btn-lg">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
    </div>

    <div id="auto_test_status" class="alert alert-info mt-3" style="display: none;">
      –°—Ç–∞—Ç—É—Å: <span id="auto_test_status_text">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
    </div>

    <!-- –ö–æ–Ω—Å–æ–ª—å –ª–æ–≥ -->
    <div class="console-log" id="console-log">
      <div class="text-muted"><small>[00:00:00] –ö–æ–Ω—Å–æ–ª—å –ª–æ–≥–≥–µ—Ä–∞ –≥–æ—Ç–æ–≤–∞...</small></div>
    </div>

    <div class="test-buttons mt-2">
      <button id="btn_clear_log" class="btn btn-sm btn-secondary">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
      <button id="btn_count_warn" class="btn btn-sm btn-warning">‚ö†Ô∏è –ü–æ—Å—á–∏—Ç–∞—Ç—å warn</button>
      <button id="btn_count_error" class="btn btn-sm btn-danger">‚ùå –ü–æ—Å—á–∏—Ç–∞—Ç—å error</button>
    </div>

    <div id="log_stats" class="alert alert-secondary mt-2" style="display: none;">
      <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–æ–≥–æ–≤:</strong><br>
      Warn: <span id="warn_count">0</span> | Error: <span id="error_count">0</span>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="mt-4">
      <a href="test-01-basic.html" class="btn btn-outline-secondary">[‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–µ—Å—Ç: –ë–∞–∑–æ–≤—ã–π]</a>
      <a href="test-03-edge-cases.html" class="btn btn-outline-primary ml-2">[–°–ª–µ–¥—É—é—â–∏–π —Ç–µ—Å—Ç: –ö—Ä–∞–π–Ω–∏–µ —Å–ª—É—á–∞–∏ ‚Üí]</a>
    </div>
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π -->
  <script type="module">
    import { FieldValidator } from '../../../modia/services/field-validator.js';
    import { FieldErrorRenderer } from '../../../modia/services/field-error-renderer.js';
    import { logger } from '../../../modia/services/logger.js';

    // ========================================================================
    // Mock Rules ‚Äî –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π
    // ========================================================================
    const mockValidationRules = [
      {
        name: 'required',
        selector: '[required]',
        defaultMessage: '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ',
        validate($field, validator) {
          const value = validator.getFieldValue();

          // ‚Üê –ù–û–í–û–ï: –õ–æ–≥ –≤ –ø—Ä–∞–≤–∏–ª–µ
          console.log(`[RULE required] getFieldValue() = "${value}"`,
            'type:', typeof value,
            'Array.isArray:', Array.isArray(value));

          const values = Array.isArray(value) ? value : [value];

          // ‚Üê –ù–û–í–û–ï: –õ–æ–≥ –ø—Ä–æ–≤–µ—Ä–∫–∏
          console.log(`[RULE required] values =`, values);

          const hasFilledValue = values.some(val => {
            const isEmpty = (val === null || val === undefined || val.trim() === '');
            console.log(`[RULE required] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è: "${val}" ‚Üí isEmpty: ${isEmpty}`);
            return !isEmpty;
          });

          const result = hasFilledValue ? true : { valid: false, params: {} };

          // ‚Üê –ù–û–í–û–ï: –õ–æ–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
          console.log(`[RULE required] –†–µ–∑—É–ª—å—Ç–∞—Ç:`, result);

          return result;
        }
      }
    ];

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let validators = {};
    let renderers = {};
    let autoTestRunning = false;
    let warnCount = 0;
    let errorCount = 0;

    // ========================================================================
    // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    // ========================================================================
    function log(message, type = 'info') {
      const $log = $('#console-log');
      const timestamp = new Date().toLocaleTimeString('ru-RU');
      const color = type === 'error' ? 'text-danger'
        : type === 'success' ? 'text-success'
          : type === 'warn' ? 'text-warning'
            : 'text-muted';
      $log.append(`<div class="${color}"><small>[${timestamp}] ${message}</small></div>`);
      $log.scrollTop($log[0].scrollHeight);
      console.log(`[FieldValidator Test] ${message}`);

      // –ü–æ–¥—Å—á—ë—Ç –ª–æ–≥–æ–≤
      if (type === 'warn') warnCount++;
      if (type === 'error') errorCount++;
    }

    // ========================================================================
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤
    // ========================================================================
    function initValidators() {
      // –£—Ä–æ–≤–µ–Ω—å 1
      const $email = $('#email-l1');
      renderers.l1 = new FieldErrorRenderer($email);
      validators.l1 = new FieldValidator($email, $email, $('#form-level-1'), mockValidationRules, renderers.l1);

      // –£—Ä–æ–≤–µ–Ω—å 2
      const $phone = $('#phone-l2');
      renderers.l2 = new FieldErrorRenderer($phone);
      validators.l2 = new FieldValidator($phone, $phone, $('#form-level-2'), mockValidationRules, renderers.l2);

      // –£—Ä–æ–≤–µ–Ω—å 3
      const $name = $('#name-l3');
      renderers.l3 = new FieldErrorRenderer($name);
      validators.l3 = new FieldValidator($name, $name, $('#form-level-3'), mockValidationRules, renderers.l3);

      // –£—Ä–æ–≤–µ–Ω—å 4
      const $password = $('#password-l4');
      renderers.l4 = new FieldErrorRenderer($password);
      validators.l4 = new FieldValidator($password, $password, $('#form-level-4'), mockValidationRules, renderers.l4);

      // –£—Ä–æ–≤–µ–Ω—å 5
      const $code = $('#code-l5');
      renderers.l5 = new FieldErrorRenderer($code);
      validators.l5 = new FieldValidator($code, $code, $('#form-level-5'), mockValidationRules, renderers.l5);

      log('–í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã', 'success');
    }

    // ========================================================================
    // –°–µ–∫—Ü–∏—è 1: –£—Ä–æ–≤–µ–Ω—å 1
    // ========================================================================
    $('#btn_validate_l1').on('click', function () {
      const isValid = validators.l1.validate();
      $('#result_1')
        .removeClass('pending pass fail')
        .addClass(isValid ? 'pass' : 'fail')
        .text(`validate(): ${isValid} (–£—Ä–æ–≤–µ–Ω—å 1: Inline)`);
      log(`–£—Ä–æ–≤–µ–Ω—å 1: validate() = ${isValid}`, isValid ? 'success' : 'info');
    });

    $('#btn_clear_l1').on('click', function () {
      validators.l1.clearError();
      $('#result_1').addClass('pass').text('–û—à–∏–±–∫–∞ –æ—á–∏—â–µ–Ω–∞');
      log('–£—Ä–æ–≤–µ–Ω—å 1: clearError()', 'info');
    });

    // ========================================================================
    // –°–µ–∫—Ü–∏—è 2: –£—Ä–æ–≤–µ–Ω—å 2
    // ========================================================================
    $('#btn_validate_l2').on('click', function () {
      const isValid = validators.l2.validate();
      $('#result_2')
        .removeClass('pending pass fail')
        .addClass(isValid ? 'pass' : 'fail')
        .text(`validate(): ${isValid} (–£—Ä–æ–≤–µ–Ω—å 2: Container)`);
      log(`–£—Ä–æ–≤–µ–Ω—å 2: validate() = ${isValid}`, isValid ? 'success' : 'info');
    });

    $('#btn_clear_l2').on('click', function () {
      validators.l2.clearError();
      $('#result_2').addClass('pass').text('–û—à–∏–±–∫–∞ –æ—á–∏—â–µ–Ω–∞');
      log('–£—Ä–æ–≤–µ–Ω—å 2: clearError()', 'info');
    });

    // ========================================================================
    // –°–µ–∫—Ü–∏—è 3: –£—Ä–æ–≤–µ–Ω—å 3
    // ========================================================================
    $('#btn_validate_l3').on('click', function () {
      const isValid = validators.l3.validate();
      $('#result_3')
        .removeClass('pending pass fail')
        .addClass(isValid ? 'pass' : 'fail')
        .text(`validate(): ${isValid} (–£—Ä–æ–≤–µ–Ω—å 3: Separate)`);
      log(`–£—Ä–æ–≤–µ–Ω—å 3: validate() = ${isValid}`, isValid ? 'success' : 'info');
    });

    $('#btn_clear_l3').on('click', function () {
      validators.l3.clearError();
      $('#result_3').addClass('pass').text('–û—à–∏–±–∫–∞ –æ—á–∏—â–µ–Ω–∞');
      log('–£—Ä–æ–≤–µ–Ω—å 3: clearError()', 'info');
    });

    $('#btn_check_log_l3').on('click', function () {
      $('#log_stats').show();
      $('#warn_count').text(warnCount);
      $('#error_count').text(errorCount);
      log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤: warn=${warnCount}, error=${errorCount}`, 'info');
    });

    // ========================================================================
    // –°–µ–∫—Ü–∏—è 4: –£—Ä–æ–≤–µ–Ω—å 4
    // ========================================================================
    $('#btn_validate_l4').on('click', function () {
      const isValid = validators.l4.validate();
      $('#result_4')
        .removeClass('pending pass fail')
        .addClass(isValid ? 'pass' : 'fail')
        .text(`validate(): ${isValid} (–£—Ä–æ–≤–µ–Ω—å 4: Default)`);
      log(`–£—Ä–æ–≤–µ–Ω—å 4: validate() = ${isValid}`, isValid ? 'success' : 'info');
    });

    $('#btn_clear_l4').on('click', function () {
      validators.l4.clearError();
      $('#result_4').addClass('pass').text('–û—à–∏–±–∫–∞ –æ—á–∏—â–µ–Ω–∞');
      log('–£—Ä–æ–≤–µ–Ω—å 4: clearError()', 'info');
    });

    $('#btn_check_log_l4').on('click', function () {
      $('#log_stats').show();
      $('#warn_count').text(warnCount);
      $('#error_count').text(errorCount);
      log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤: warn=${warnCount}, error=${errorCount}`, 'info');
    });

    // ========================================================================
    // –°–µ–∫—Ü–∏—è 5: –£—Ä–æ–≤–µ–Ω—å 5
    // ========================================================================
    $('#btn_validate_l5').on('click', function () {
      const isValid = validators.l5.validate();
      $('#result_5')
        .removeClass('pending pass fail')
        .addClass(isValid ? 'pass' : 'fail')
        .text(`validate(): ${isValid} (–£—Ä–æ–≤–µ–Ω—å 5: Fallback)`);
      log(`–£—Ä–æ–≤–µ–Ω—å 5: validate() = ${isValid}`, isValid ? 'success' : 'info');
    });

    $('#btn_clear_l5').on('click', function () {
      validators.l5.clearError();
      $('#result_5').addClass('pass').text('–û—à–∏–±–∫–∞ –æ—á–∏—â–µ–Ω–∞');
      log('–£—Ä–æ–≤–µ–Ω—å 5: clearError()', 'info');
    });

    $('#btn_check_log_l5').on('click', function () {
      $('#log_stats').show();
      $('#warn_count').text(warnCount);
      $('#error_count').text(errorCount);
      log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤: warn=${warnCount}, error=${errorCount}`, 'info');
    });

    // ========================================================================
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–æ–≥–æ–≤
    // ========================================================================
    $('#btn_count_warn').on('click', function () {
      $('#log_stats').show();
      $('#warn_count').text(warnCount);
      log(`warn count: ${warnCount}`, 'info');
    });

    $('#btn_count_error').on('click', function () {
      $('#log_stats').show();
      $('#error_count').text(errorCount);
      log(`error count: ${errorCount}`, 'info');
    });

    // ========================================================================
    // –ê–≤—Ç–æ-—Ç–µ—Å—Ç
    // ========================================================================
    async function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function runAutoTestAll() {
      if (autoTestRunning) return;
      autoTestRunning = true;

      $('#auto_test_status').show();
      $('#auto_test_status_text').text('–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤...');

      log('=== –ó–ê–ü–£–°–ö –ê–í–¢–û-–¢–ï–°–¢–ê ===', 'info');

      // –°–µ–∫—Ü–∏—è 1
      $('#auto_test_status_text').text('–°–µ–∫—Ü–∏—è 1: –£—Ä–æ–≤–µ–Ω—å 1...');
      $('#section_1').addClass('auto-test-running');
      await sleep(500);
      $('#btn_validate_l1').click();
      await sleep(800);
      $('#btn_clear_l1').click();
      await sleep(500);
      $('#section_1').removeClass('auto-test-running');

      // –°–µ–∫—Ü–∏—è 2
      $('#auto_test_status_text').text('–°–µ–∫—Ü–∏—è 2: –£—Ä–æ–≤–µ–Ω—å 2...');
      $('#section_2').addClass('auto-test-running');
      await sleep(500);
      $('#btn_validate_l2').click();
      await sleep(800);
      $('#btn_clear_l2').click();
      await sleep(500);
      $('#section_2').removeClass('auto-test-running');

      // –°–µ–∫—Ü–∏—è 3
      $('#auto_test_status_text').text('–°–µ–∫—Ü–∏—è 3: –£—Ä–æ–≤–µ–Ω—å 3...');
      $('#section_3').addClass('auto-test-running');
      await sleep(500);
      $('#btn_validate_l3').click();
      await sleep(800);
      $('#btn_check_log_l3').click();
      await sleep(500);
      $('#section_3').removeClass('auto-test-running');

      // –°–µ–∫—Ü–∏—è 4
      $('#auto_test_status_text').text('–°–µ–∫—Ü–∏—è 4: –£—Ä–æ–≤–µ–Ω—å 4...');
      $('#section_4').addClass('auto-test-running');
      await sleep(500);
      $('#btn_validate_l4').click();
      await sleep(800);
      $('#btn_check_log_l4').click();
      await sleep(500);
      $('#section_4').removeClass('auto-test-running');

      // –°–µ–∫—Ü–∏—è 5
      $('#auto_test_status_text').text('–°–µ–∫—Ü–∏—è 5: –£—Ä–æ–≤–µ–Ω—å 5...');
      $('#section_5').addClass('auto-test-running');
      await sleep(500);
      $('#btn_validate_l5').click();
      await sleep(800);
      $('#btn_check_log_l5').click();
      await sleep(500);
      $('#section_5').removeClass('auto-test-running');

      $('#auto_test_status_text').text('‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!');
      $('#auto_test_status').addClass('alert-success');
      log('=== –ê–í–¢–û-–¢–ï–°–¢ –ó–ê–í–ï–†–®–Å–ù ===', 'success');

      autoTestRunning = false;
    }

    $('#btn_auto_test_all').on('click', runAutoTestAll);

    $('#btn_stop_test').on('click', function () {
      autoTestRunning = false;
      $('#auto_test_status').hide();
      $('.auto-test-running').removeClass('auto-test-running');
      log('–ê–≤—Ç–æ—Ç–µ—Å—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º', 'warn');
    });

    $('#btn_clear_log').on('click', function () {
      $('#console-log').html('<div class="text-muted"><small>[00:00:00] –õ–æ–≥ –æ—á–∏—â–µ–Ω...</small></div>');
      warnCount = 0;
      errorCount = 0;
      $('#log_stats').hide();
      log('–õ–æ–≥ –æ—á–∏—â–µ–Ω', 'info');
    });

    // ========================================================================
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    // ========================================================================
    $(document).ready(function () {
      initValidators();
      log('–¢–µ—Å—Ç FieldValidator –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'success');
    });
  </script>
</body>

</html>