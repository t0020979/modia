<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modia ‚Äî –¢–µ—Å—Ç Core (v1.2)</title>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <link rel="stylesheet" href="../modia/modia.css">
  <link rel="stylesheet" href="examples.css">
</head>

<body data-modia-log>
  <div class="container">
    <h1>üß™ –¢–µ—Å—Ç Core (v1.2)</h1>
    <p>–ü—Ä–æ–≤–µ—Ä–∫–∞: BaseComponent, Container, ComponentScanner</p>

    <div id="status" class="test-result pending">üìç –°—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...</div>

    <!-- ========================================================================== -->
    <!-- –ë–ê–ó–û–í–´–ï –¢–ï–°–¢–´ (6) -->
    <!-- ========================================================================== -->

    <!-- –¢–ï–°–¢ 1: jQuery Data API + –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="test-section">
      <h3>üì¶ –¢–µ—Å—Ç 1: jQuery Data API –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è</h3>

      <form data-component="validation" id="form1">
        <label>Email *</label>
        <input type="email" name="email" required>
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É 1</button>
      </form>

      <form data-component="validation" id="form2">
        <label>–¢–µ–ª–µ—Ñ–æ–Ω *</label>
        <input type="tel" name="phone" required>
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É 2</button>
      </form>

      <div class="test-result pending" id="test1-result">–û–∂–∏–¥–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...</div>

      <div class="test-buttons">
        <button id="btn-rescan">üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
        <button id="btn-registry">üìã –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–µ—Å—Ç—Ä</button>
        <button id="btn-find">üîç –ù–∞–π—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç</button>
      </div>

      <div class="registry-display" id="test1-registry" style="display:none;"></div>

      <div class="expected-result">
        <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
        <ul>
          <li>2 —Ñ–æ—Ä–º—ã = 2 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ ValidationComponent</li>
          <li>–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–µ –¥—É–±–ª–∏–∫–∞—Ç—ã</li>
          <li>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ <code>$.data('modia-component')</code></li>
          <li>–†–µ–µ—Å—Ç—Ä ComponentScanner.instances –∑–∞–ø–æ–ª–Ω–µ–Ω</li>
        </ul>
      </div>
    </div>

    <!-- –¢–ï–°–¢ 2: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ -->
    <div class="test-section">
      <h3>‚öôÔ∏è –¢–µ—Å—Ç 2: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</h3>

      <div data-component="validation" data-validation-live="true" data-validation-debounce="300"
        data-validation-validate-on-submit="false" data-validation-max-length="600" id="config-test-component">
        –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
      </div>

      <div class="test-result pending" id="test2-result">–û–∂–∏–¥–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...</div>

      <div class="test-buttons">
        <button id="btn-check-config">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é</button>
      </div>

      <div class="registry-display" id="test2-config" style="display:none;"></div>

      <div class="expected-result">
        <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
        <ul>
          <li><code>live</code> ‚Üí <code>boolean</code> (true)</li>
          <li><code>debounce</code> ‚Üí <code>number</code> (300)</li>
          <li><code>validateOnSubmit</code> ‚Üí <code>boolean</code> (false)</li>
          <li><code>maxLength</code> ‚Üí <code>number</code> (600)</li>
        </ul>
      </div>
    </div>

    <!-- –¢–ï–°–¢ 3: –û—á–∏—Å—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π -->
    <div class="test-section">
      <h3>üîå –¢–µ—Å—Ç 3: –û—á–∏—Å—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π</h3>

      <div class="test-component" id="test3-component">
        –í—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∞ –æ—á–∏—Å—Ç–∫–∏
      </div>

      <div class="test-result pending" id="test3-result">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏...</div>

      <div class="test-buttons">
        <button id="btn-create-component">‚ûï –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç</button>
        <button id="btn-destroy-component">üóëÔ∏è –£–Ω–∏—á—Ç–æ–∂–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç</button>
        <button id="btn-check-handlers">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏</button>
      </div>

      <div class="registry-display" id="test3-handlers" style="display:none;"></div>

      <div class="expected-result">
        <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
        <ul>
          <li>–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ <code>_eventHandlers</code></li>
          <li>–ü–æ—Å–ª–µ <code>destroy()</code> ‚Äî <code>_eventHandlers.length === 0</code></li>
          <li>–ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏</li>
        </ul>
      </div>
    </div>

    <!-- –¢–ï–°–¢ 4: Container –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ -->
    <div class="test-section">
      <h3>üì¢ –¢–µ—Å—Ç 4: Container –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏</h3>

      <div class="state-display">
        –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: <span id="current-state">null</span>
      </div>

      <div class="test-result pending" id="test4-result">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏...</div>

      <div class="test-buttons">
        <button id="btn-set-cross">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å formMode: cross</button>
        <button id="btn-set-inline">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å formMode: inline</button>
        <button id="btn-clear-log">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
      </div>

      <div class="event-log" id="test4-log"></div>

      <div class="expected-result">
        <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
        <ul>
          <li>–ü—Ä–∏ <code>setState()</code> ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç <code>onStateChange()</code></li>
          <li>–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ <code>container.state</code></li>
        </ul>
      </div>
    </div>

    <!-- –¢–ï–°–¢ 5: –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è Modia -->
    <div class="test-section">
      <h3>üì° –¢–µ—Å—Ç 5: –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è Modia</h3>

      <div class="test-result pending" id="test5-result">–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π...</div>

      <div class="test-buttons">
        <button id="btn-scan">üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å scan()</button>
        <button id="btn-clear-events">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
      </div>

      <div class="event-log" id="test5-log"></div>

      <div class="expected-result">
        <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
        <ul>
          <li><code>modia:component-created</code> ‚Äî –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞</li>
          <li><code>modia:scanned</code> ‚Äî –ø–æ—Å–ª–µ <code>scan()</code></li>
          <li><code>modia:initialized</code> ‚Äî –ø—Ä–∏ –∞–≤—Ç–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</li>
          <li><code>modia:component-destroyed</code> ‚Äî –ø—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏</li>
        </ul>
      </div>
    </div>

    <!-- –¢–ï–°–¢ 6: BaseComponent.fromElement() -->
    <div class="test-section">
      <h3>üîç –¢–µ—Å—Ç 6: BaseComponent.fromElement()</h3>

      <form data-component="validation" id="form-from-element">
        <label>–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ</label>
        <input type="text" name="test" required>
      </form>

      <div class="test-result pending" id="test6-result">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏...</div>

      <div class="test-buttons">
        <button id="btn-check-from-element">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å fromElement()</button>
      </div>

      <div class="expected-result">
        <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
        <ul>
          <li><code>fromElement()</code> –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ—Ç –∂–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, —á—Ç–æ –∏ <code>$.data()</code></li>
          <li>–û–±–∞ –º–µ—Ç–æ–¥–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</li>
        </ul>
      </div>
    </div>

    <!-- ========================================================================== -->
    <!-- –†–ê–°–®–ò–†–ï–ù–ù–´–ï –¢–ï–°–¢–´ (5) -->
    <!-- ========================================================================== -->

    <!-- –¢–ï–°–¢ 7: ComponentScanner.components (—Ä–µ–µ—Å—Ç—Ä –∫–ª–∞—Å—Å–æ–≤) -->
    <div class="test-section">
      <h3>üìã –¢–µ—Å—Ç 7: ComponentScanner.components (—Ä–µ–µ—Å—Ç—Ä –∫–ª–∞—Å—Å–æ–≤)</h3>

      <div class="test-result pending" id="test7-result">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏...</div>

      <div class="test-buttons">
        <button id="btn-check-registry">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–µ—Å—Ç—Ä –∫–ª–∞—Å—Å–æ–≤</button>
      </div>

      <div class="registry-display" id="test7-registry" style="display:none;"></div>

      <div class="expected-result">
        <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
        <ul>
          <li><code>ComponentScanner.components</code> —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã</li>
          <li>–ö–ª—é—á–∏ = componentName (validation, debug, etc.)</li>
        </ul>
      </div>
    </div>

    <!-- –¢–ï–°–¢ 8: scan(root) —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º -->
    <div class="test-section">
      <h3>üîç –¢–µ—Å—Ç 8: scan(root) —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º</h3>

      <div id="ajax-container">
        <p>–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è AJAX-—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</p>
        <form data-component="validation" id="ajax-form">
          <label>–ü–æ–ª–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ</label>
          <input type="text" name="ajax-field" required>
        </form>
      </div>

      <div class="test-result pending" id="test8-result">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏...</div>

      <div class="test-buttons">
        <button id="btn-scan-container">üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä</button>
      </div>

      <div class="expected-result">
        <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
        <ul>
          <li><code>scan(root)</code> –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ root</li>
          <li>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–Ω–µ root –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç—Å—è</li>
        </ul>
      </div>
    </div>

    <!-- –¢–ï–°–¢ 9: Container.destroy() + removeComponent() -->
    <div class="test-section">
      <h3>üóëÔ∏è –¢–µ—Å—Ç 9: Container.destroy() + removeComponent()</h3>

      <div class="test-result pending" id="test9-result">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏...</div>

      <div class="test-buttons">
        <button id="btn-remove-component">üóëÔ∏è removeComponent()</button>
        <button id="btn-destroy-container">üí• Container.destroy()</button>
      </div>

      <div class="registry-display" id="test9-container" style="display:none;"></div>

      <div class="expected-result">
        <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
        <ul>
          <li><code>removeComponent()</code> —É–¥–∞–ª—è–µ—Ç –æ–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç</li>
          <li><code>Container.destroy()</code> —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã</li>
        </ul>
      </div>
    </div>

    <!-- –¢–ï–°–¢ 10: Constructor —Å null —ç–ª–µ–º–µ–Ω—Ç–æ–º (error handling) -->
    <div class="test-section">
      <h3>‚ö†Ô∏è –¢–µ—Å—Ç 10: Constructor —Å null —ç–ª–µ–º–µ–Ω—Ç–æ–º (error handling)</h3>

      <div class="test-result pending" id="test10-result">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏...</div>

      <div class="test-buttons">
        <button id="btn-null-element">‚ö†Ô∏è –°–æ–∑–¥–∞—Ç—å —Å null</button>
      </div>

      <div class="registry-display" id="test10-error" style="display:none;"></div>

      <div class="expected-result">
        <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
        <ul>
          <li>Constructor –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ null —ç–ª–µ–º–µ–Ω—Ç–µ</li>
          <li>–û—à–∏–±–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</li>
        </ul>
      </div>
    </div>

    <!-- –¢–ï–°–¢ 11: try/catch –≤ scan() -->
    <div class="test-section">
      <h3>üõ°Ô∏è –¢–µ—Å—Ç 11: try/catch –≤ scan() (–∑–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫)</h3>

      <div class="test-result pending" id="test11-result">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏...</div>

      <div class="test-buttons">
        <button id="btn-scan-with-error">üõ°Ô∏è –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ—à–∏–±–∫–æ–π</button>
      </div>

      <div class="event-log" id="test11-log"></div>

      <div class="expected-result">
        <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
        <ul>
          <li>–û—à–∏–±–∫–∞ –æ–¥–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–µ –ª–æ–º–∞–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
          <li>–û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è</li>
          <li>–û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ logger</li>
        </ul>
      </div>
    </div>

    <!-- ========================================================================== -->
    <!-- –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê -->
    <!-- ========================================================================== -->

    <div class="test-section">
      <h3>üìã –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</h3>

      <div class="registry-display" id="global-registry">–ü—É—Å—Ç–æ</div>

      <div class="test-buttons">
        <button id="btn-refresh-registry">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        <button id="btn-clear-all">üßπ –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
      </div>
    </div>

  </div>

  <!-- ‚úÖ –í–ê–ñ–ù–û: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º index.js –¥–ª—è –∞–≤—Ç–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ -->
  <script type="module" src="../modia/index.js"></script>

  <script type="module">
    import { ComponentScanner, container, BaseComponent } from '../modia/core.js';
    import { logger } from '../modia/services/logger.js';

    // ============================================================================
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
    // ============================================================================
    let testComponent = null;
    let eventLog = [];
    let stateChangeLog = [];

    // ============================================================================
    // –£—Ç–∏–ª–∏—Ç—ã
    // ============================================================================
    function setStatus(message, type = 'pending') {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = `test-result ${type}`;
    }

    function setTestResult(testId, message, type = 'pending') {
      const result = document.getElementById(testId);
      if (result) {
        result.textContent = message;
        result.className = `test-result ${type}`;
      }
    }

    function showElement(elementId) {
      const el = document.getElementById(elementId);
      if (el) el.style.display = 'block';
    }

    function hideElement(elementId) {
      const el = document.getElementById(elementId);
      if (el) el.style.display = 'none';
    }

    function logEvent(event) {
      eventLog.push(`[${new Date().toLocaleTimeString()}] ${event}`);
      const logEl = document.getElementById('test5-log');
      if (logEl) {
        logEl.textContent = eventLog.join('\n');
        logEl.scrollTop = logEl.scrollHeight;
      }
    }

    function logStateChange(message) {
      stateChangeLog.push(`[${new Date().toLocaleTimeString()}] ${message}`);
      const logEl = document.getElementById('test4-log');
      if (logEl) {
        logEl.textContent = stateChangeLog.join('\n');
        logEl.scrollTop = logEl.scrollHeight;
      }
    }

    function updateRegistry() {
      const registryEl = document.getElementById('global-registry');
      if (registryEl) {
        const instances = ComponentScanner.instances || [];
        if (instances.length === 0) {
          registryEl.textContent = '–ü—É—Å—Ç–æ';
        } else {
          registryEl.textContent = instances.map((c, i) =>
            `${i + 1}. ${c.constructor.name} (${c.$el ? c.$el.attr('id') || 'no-id' : 'destroyed'})`
          ).join('\n');
        }
      }
    }

    // ============================================================================
    // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è Modia
    // ============================================================================
    $(document).on('modia:initialized', (e, data) => {
      logEvent(`modia:initialized ‚Äî ${data.instances.length} –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤`);
      setStatus(`‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: ${data.instances.length} –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤`, 'pass');

      // –¢–µ—Å—Ç 1: jQuery Data API
      const forms = $('form[data-component="validation"]');
      let initializedCount = 0;
      forms.each((i, form) => {
        const component = $(form).data('modia-component');
        if (component) initializedCount++;
      });

      if (initializedCount >= 2) {
        setTestResult('test1-result', `‚úÖ ${initializedCount} —Ñ–æ—Ä–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ`, 'pass');
      } else {
        setTestResult('test1-result', `‚ùå –û–∂–∏–¥–∞–ª–æ—Å—å 2+, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ${initializedCount}`, 'fail');
      }

      // –¢–µ—Å—Ç 2: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
      const configComponent = $('#config-test-component').data('modia-component');
      if (configComponent) {
        setTestResult('test2-result', '‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'pass');
      }

      updateRegistry();
    });

    $(document).on('modia:scanned', (e, data) => {
      logEvent(`modia:scanned ‚Üí ${data.instances.length}`);
      updateRegistry();
    });

    $(document).on('modia:component-created', (e, data) => {
      logEvent(`component-created: ${data.component.constructor.name}`);
    });

    $(document).on('modia:component-destroyed', (e, data) => {
      logEvent(`component-destroyed: ${data.component.constructor.name}`);
      updateRegistry();
    });

    // ============================================================================
    // –¢–µ—Å—Ç 1: –ö–Ω–æ–ø–∫–∏
    // ============================================================================
    document.getElementById('btn-rescan')?.addEventListener('click', () => {
      logEvent('–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...');
      const instances = ComponentScanner.scan();
      setTestResult('test1-result', `üîÑ –ù–∞–π–¥–µ–Ω–æ: ${instances.length}`, 'pending');
      updateRegistry();
    });

    document.getElementById('btn-registry')?.addEventListener('click', () => {
      const registryEl = document.getElementById('test1-registry');
      const instances = ComponentScanner.instances || [];
      registryEl.textContent = instances.map((c, i) =>
        `${i + 1}. ${c.constructor.name}`
      ).join('\n');
      showElement('test1-registry');
    });

    document.getElementById('btn-find')?.addEventListener('click', () => {
      const form = document.getElementById('form1');
      const component = BaseComponent.fromElement(form);
      if (component) {
        setTestResult('test1-result', `‚úÖ –ù–∞–π–¥–µ–Ω: ${component.constructor.name}`, 'pass');
      } else {
        setTestResult('test1-result', '‚ùå –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'fail');
      }
    });

    // ============================================================================
    // –¢–µ—Å—Ç 2: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤
    // ============================================================================
    document.getElementById('btn-check-config')?.addEventListener('click', () => {
      const component = BaseComponent.fromElement(document.getElementById('config-test-component'));
      if (!component) {
        setTestResult('test2-result', '‚ùå –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'fail');
        return;
      }

      const config = component.config;
      const checks = [
        { name: 'live', expected: 'boolean', actual: typeof config.live, value: config.live },
        { name: 'debounce', expected: 'number', actual: typeof config.debounce, value: config.debounce },
        { name: 'validateOnSubmit', expected: 'boolean', actual: typeof config.validateOnSubmit, value: config.validateOnSubmit },
        { name: 'maxLength', expected: 'number', actual: typeof config.maxLength, value: config.maxLength }
      ];

      const configEl = document.getElementById('test2-config');
      configEl.textContent = checks.map(c =>
        `${c.name}: ${c.value} (${c.actual}) ${c.actual === c.expected ? '‚úÖ' : '‚ùå'}`
      ).join('\n');
      showElement('test2-config');

      const allPass = checks.every(c => c.actual === c.expected);
      setTestResult('test2-result', allPass ? '‚úÖ –í—Å–µ —Ç–∏–ø—ã –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã' : '‚ùå –û—à–∏–±–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏', allPass ? 'pass' : 'fail');
    });

    // ============================================================================
    // –¢–µ—Å—Ç 3: –û—á–∏—Å—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
    // ============================================================================
    class TestComponent extends BaseComponent {
      static get componentName() { return 'test'; }

      constructor(element) {
        super(element);
        this._on('click', () => {
          console.log('TestComponent click');
        });
        this._on('mouseover', () => {
          console.log('TestComponent mouseover');
        });
      }
    }

    document.getElementById('btn-create-component')?.addEventListener('click', () => {
      const el = document.getElementById('test3-component');
      testComponent = new TestComponent(el);
      const handlersEl = document.getElementById('test3-handlers');
      handlersEl.textContent = `–û–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤: ${testComponent._eventHandlers.length}`;
      showElement('test3-handlers');
      setTestResult('test3-result', `‚úÖ –°–æ–∑–¥–∞–Ω, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤: ${testComponent._eventHandlers.length}`, 'pass');
    });

    document.getElementById('btn-destroy-component')?.addEventListener('click', () => {
      if (testComponent) {
        testComponent.destroy();
        setTestResult('test3-result', '‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —É–Ω–∏—á—Ç–æ–∂–µ–Ω', 'pass');
      } else {
        setTestResult('test3-result', '‚ùå –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω', 'fail');
      }
    });

    document.getElementById('btn-check-handlers')?.addEventListener('click', () => {
      const handlersEl = document.getElementById('test3-handlers');
      if (testComponent && testComponent._eventHandlers) {
        handlersEl.textContent = `–û–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤: ${testComponent._eventHandlers.length}`;
        showElement('test3-handlers');
        const count = testComponent._eventHandlers.length;
        setTestResult('test3-result', count === 0 ? '‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—á–∏—â–µ–Ω—ã' : `‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤: ${count}`, count === 0 ? 'pass' : 'fail');
      } else {
        handlersEl.textContent = '–ö–æ–º–ø–æ–Ω–µ–Ω—Ç —É–Ω–∏—á—Ç–æ–∂–µ–Ω';
        showElement('test3-handlers');
        setTestResult('test3-result', '‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —É–Ω–∏—á—Ç–æ–∂–µ–Ω (–Ω–µ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)', 'pass');
      }
    });

    // ============================================================================
    // –¢–µ—Å—Ç 4: Container.setState()
    // ============================================================================
    document.getElementById('btn-set-cross')?.addEventListener('click', () => {
      container.setState({ formMode: 'cross' });
      document.getElementById('current-state').textContent = JSON.stringify(container.state);
      logStateChange('setState: formMode = cross');
      setTestResult('test4-result', '‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'pass');
    });

    document.getElementById('btn-set-inline')?.addEventListener('click', () => {
      container.setState({ formMode: 'inline' });
      document.getElementById('current-state').textContent = JSON.stringify(container.state);
      logStateChange('setState: formMode = inline');
      setTestResult('test4-result', '‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'pass');
    });

    document.getElementById('btn-clear-log')?.addEventListener('click', () => {
      stateChangeLog = [];
      document.getElementById('test4-log').textContent = '';
    });

    // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ onStateChange –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    const originalOnStateChange = BaseComponent.prototype.onStateChange;
    BaseComponent.prototype.onStateChange = function (newState) {
      logStateChange(`onStateChange ${this.constructor.name} ${JSON.stringify(newState)}`);
      if (originalOnStateChange) originalOnStateChange.call(this, newState);
    };

    // ============================================================================
    // –¢–µ—Å—Ç 5: –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
    // ============================================================================
    document.getElementById('btn-scan')?.addEventListener('click', () => {
      logEvent('–ó–∞–ø—É—Å–∫ scan()...');
      const instances = ComponentScanner.scan();
      logEvent(`scan() –≤–µ—Ä–Ω—É–ª: ${instances.length}`);
      setTestResult('test5-result', `‚úÖ scan() –∑–∞–≤–µ—Ä—à—ë–Ω: ${instances.length} –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤`, 'pass');
    });

    document.getElementById('btn-clear-events')?.addEventListener('click', () => {
      eventLog = [];
      document.getElementById('test5-log').textContent = '';
    });

    // ============================================================================
    // –¢–µ—Å—Ç 6: fromElement()
    // ============================================================================
    document.getElementById('btn-check-from-element')?.addEventListener('click', () => {
      const form = document.getElementById('form-from-element');
      const fromData = $(form).data('modia-component');
      const fromMethod = BaseComponent.fromElement(form);

      if (fromData && fromMethod && fromData === fromMethod) {
        setTestResult('test6-result', '‚úÖ fromElement() === $.data()', 'pass');
      } else {
        setTestResult('test6-result', '‚ùå –ú–µ—Ç–æ–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è', 'fail');
      }
    });

    // ============================================================================
    // –¢–µ—Å—Ç 7: –†–µ–µ—Å—Ç—Ä –∫–ª–∞—Å—Å–æ–≤
    // ============================================================================
    document.getElementById('btn-check-registry')?.addEventListener('click', () => {
      const registryEl = document.getElementById('test7-registry');
      const components = ComponentScanner.components || {};
      const names = Object.keys(components);

      registryEl.textContent = `–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ: ${names.length}\n${names.join('\n')}`;
      showElement('test7-registry');

      if (names.length > 0) {
        setTestResult('test7-result', `‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ: ${names.join(', ')}`, 'pass');
      } else {
        setTestResult('test7-result', '‚ùå –†–µ–µ—Å—Ç—Ä –ø—É—Å—Ç', 'fail');
      }
    });

    // ============================================================================
    // –¢–µ—Å—Ç 8: scan(root) —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º
    // ============================================================================
    document.getElementById('btn-scan-container')?.addEventListener('click', () => {
      const containerEl = document.getElementById('ajax-container');
      const instances = ComponentScanner.scan(containerEl);

      if (instances.length > 0) {
        setTestResult('test8-result', `‚úÖ –ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ: ${instances.length}`, 'pass');
      } else {
        setTestResult('test8-result', '‚ö†Ô∏è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã', 'pending');
      }
    });

    // ============================================================================
    // –¢–µ—Å—Ç 9: Container.destroy()
    // ============================================================================
    document.getElementById('btn-remove-component')?.addEventListener('click', () => {
      const instances = ComponentScanner.instances || [];
      if (instances.length > 0) {
        const component = instances[0];
        container.removeComponent(component);
        const registryEl = document.getElementById('test9-container');
        registryEl.textContent = `–£–¥–∞–ª—ë–Ω: ${component.constructor.name}\n–û—Å—Ç–∞–ª–æ—Å—å: ${ComponentScanner.instances.length}`;
        showElement('test9-container');
        setTestResult('test9-result', '‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —É–¥–∞–ª—ë–Ω –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞', 'pass');
        updateRegistry();
      } else {
        setTestResult('test9-result', '‚ùå –ù–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è', 'fail');
      }
    });

    document.getElementById('btn-destroy-container')?.addEventListener('click', () => {
      const count = ComponentScanner.instances ? ComponentScanner.instances.length : 0;
      container.destroy();
      const registryEl = document.getElementById('test9-container');
      registryEl.textContent = `–£–Ω–∏—á—Ç–æ–∂–µ–Ω–æ: ${count} –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤\n–û—Å—Ç–∞–ª–æ—Å—å: ${ComponentScanner.instances ? ComponentScanner.instances.length : 0}`;
      showElement('test9-container');
      setTestResult('test9-result', '‚úÖ Container.destroy() –∑–∞–≤–µ—Ä—à—ë–Ω', 'pass');
      updateRegistry();
    });

    // ============================================================================
    // –¢–µ—Å—Ç 10: Constructor —Å null
    // ============================================================================
    document.getElementById('btn-null-element')?.addEventListener('click', () => {
      try {
        const component = new BaseComponent(null);
        setTestResult('test10-result', '‚ùå –û—à–∏–±–∫–∞ –Ω–µ –≤—ã–±—Ä–æ—à–µ–Ω–∞', 'fail');
      } catch (error) {
        const errorEl = document.getElementById('test10-error');
        errorEl.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
        showElement('test10-error');
        setTestResult('test10-result', '‚úÖ –û—à–∏–±–∫–∞ –≤—ã–±—Ä–æ—à–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'pass');
      }
    });

    // ============================================================================
    // –¢–µ—Å—Ç 11: try/catch –≤ scan()
    // ============================================================================
    document.getElementById('btn-scan-with-error')?.addEventListener('click', () => {
      try {
        const instances = ComponentScanner.scan();
        const logEl = document.getElementById('test11-log');
        logEl.textContent = `scan() –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ: ${instances.length} –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤`;
        setTestResult('test11-result', '‚úÖ scan() –Ω–µ —É–ø–∞–ª', 'pass');
      } catch (error) {
        setTestResult('test11-result', `‚ùå scan() —É–ø–∞–ª: ${error.message}`, 'fail');
      }
    });

    // ============================================================================
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
    // ============================================================================
    document.getElementById('btn-refresh-registry')?.addEventListener('click', updateRegistry);

    document.getElementById('btn-clear-all')?.addEventListener('click', () => {
      container.destroy();
      eventLog = [];
      stateChangeLog = [];
      document.getElementById('test4-log').textContent = '';
      document.getElementById('test5-log').textContent = '';
      document.getElementById('current-state').textContent = 'null';
      updateRegistry();
      setStatus('üìç –°—Ç–∞—Ç—É—Å: –û—á–∏—â–µ–Ω–æ', 'pending');
    });

    // ============================================================================
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    // ============================================================================
    setStatus('üìç –°—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...', 'pending');
    updateRegistry();
  </script>
</body>

</html>