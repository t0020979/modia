<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>Modia ‚Äî –¢–µ—Å—Ç Core</title>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="../modia/modia.css">
</head>

<body data-modia-log>
  <div class="container mt-5">
    <h1>üß™ –¢–µ—Å—Ç Core (BaseComponent + ComponentScanner)</h1>
    <p class="lead">–ü—Ä–æ–≤–µ—Ä–∫–∞: jQuery Data API, —Ä–µ–µ—Å—Ç—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è.</p>

    <form data-component="validation" id="form1" class="mt-4">
      <div class="form-group">
        <label>–§–æ—Ä–º–∞ 1 ‚Äî Email:</label>
        <input type="email" class="form-control" name="email" required>
      </div>
      <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É 1</button>
    </form>

    <form data-component="validation" id="form2" class="mt-4">
      <div class="form-group">
        <label>–§–æ—Ä–º–∞ 2 ‚Äî –¢–µ–ª–µ—Ñ–æ–Ω:</label>
        <input type="tel" class="form-control" name="phone" required>
      </div>
      <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É 2</button>
    </form>

    <div class="test-buttons mt-4">
      <button id="test-scan" class="btn btn-success mr-2">üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
      <button id="test-registry" class="btn btn-info mr-2">üìã –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–µ—Å—Ç—Ä</button>
      <button id="test-from-element" class="btn btn-warning">üîç –ù–∞–π—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç</button>
    </div>

    <div id="registry-output" class="mt-4 p-3 bg-light border rounded"></div>

    <hr class="my-5">
    <h3>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
    <ul>
      <li>2 —Ñ–æ—Ä–º—ã = 2 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ ValidationComponent</li>
      <li>–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–µ –¥—É–±–ª–∏–∫–∞—Ç—ã</li>
      <li>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ <code>$.data('modia-component')</code></li>
      <li>–†–µ–µ—Å—Ç—Ä ComponentScanner.instances –∑–∞–ø–æ–ª–Ω–µ–Ω</li>
    </ul>
  </div>

  <script type="module">
    import '../modia/index.js';
    import { ComponentScanner, BaseComponent } from '../modia/core.js';

    $('#test-scan').on('click', () => {
      Modia.info('–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...', 'Test-02');
      const instances = Modia.scan();
      Modia.warn(`–ù–∞–π–¥–µ–Ω–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: ${instances.length}`, 'Test-02');
    });

    $('#test-registry').on('click', () => {
      const registry = ComponentScanner.instances;
      const output = registry.map((inst, i) =>
        `<div>[${i}] ${inst.constructor.name} –Ω–∞ #${inst.$el[0].id || 'no-id'}</div>`
      ).join('');
      $('#registry-output').html(output || '–†–µ–µ—Å—Ç—Ä –ø—É—Å—Ç');
      Modia.info(`–†–µ–µ—Å—Ç—Ä: ${registry.length} –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤`, 'Test-02');
    });

    $('#test-from-element').on('click', () => {
      const comp = BaseComponent.fromElement($('#form1')[0]);
      if (comp) {
        Modia.success(`–ù–∞–π–¥–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: ${comp.constructor.name}`, 'Test-02');
      } else {
        Modia.error('–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'Test-02');
      }
    });

    // –ê–≤—Ç–æ-—Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    $(document).on('modia:initialized', (e, data) => {
      Modia.success(`modia:initialized ‚Äî ${data.instances.length} –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤`, 'Test-02');
    });
  </script>
</body>

</html>