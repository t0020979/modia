<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modia ‚Äî –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ValidationComponent</title>

  <!-- ‚úÖ jQuery CDN (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û) -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <!-- ‚úÖ Bootstrap 4 CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <!-- ‚úÖ Modia CSS (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û - —Å–∫—Ä—ã–≤–∞–µ—Ç —à–∞–±–ª–æ–Ω—ã –æ—à–∏–±–æ–∫) -->
  <link rel="stylesheet" href="../../../modia/modia.css">

  <!-- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã CSS (2 —É—Ä–æ–≤–Ω—è –≤–≤–µ—Ä—Ö) -->
  <link rel="stylesheet" href="../../examples.css">

  <style>
    .init-status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 3px;
      font-weight: 500;
    }

    .init-status.pending {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
    }

    .init-status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .init-status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .log-entry {
      font-family: monospace;
      font-size: 12px;
      padding: 2px 0;
    }

    .log-info {
      color: #007bff;
    }

    .log-success {
      color: #28a745;
    }

    .log-error {
      color: #dc3545;
    }

    .log-warn {
      color: #ffc107;
    }
  </style>
</head>

<body>
  <div class="container mt-5">
    <h1>üß™ –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ValidationComponent</h1>
    <p class="text-muted">–¢–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏</p>

    <!-- ============================================================ -->
    <!-- –°–ï–ö–¶–ò–Ø 1: –°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <!-- ============================================================ -->
    <div class="test-section">
      <h3>üìç –°–µ–∫—Ü–∏—è 1: –°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏</h3>

      <div id="init-status" class="init-status pending">
        –°—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏...
      </div>

      <div class="expected-result">
        <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
        <ul>
          <li>jQuery –∑–∞–≥—Ä—É–∂–µ–Ω</li>
          <li>Bootstrap —Å—Ç–∏–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã</li>
          <li><code>examples.css</code> –ø–æ–¥–∫–ª—é—á—ë–Ω</li>
          <li><code>modia.css</code> –ø–æ–¥–∫–ª—é—á—ë–Ω (—Å–∫—Ä—ã–≤–∞–µ—Ç —à–∞–±–ª–æ–Ω—ã)</li>
          <li><code>modia/index.js</code> –∑–∞–≥—Ä—É–∂–µ–Ω –±–µ–∑ –æ—à–∏–±–æ–∫</li>
          <li>Logger —Ä–∞–±–æ—Ç–∞–µ—Ç</li>
          <li>ComponentScanner.scan() –≤—ã–ø–æ–ª–Ω–µ–Ω</li>
          <li>ValidationComponent –Ω–∞–π–¥–µ–Ω –≤ DOM</li>
        </ul>
      </div>
    </div>

    <!-- ============================================================ -->
    <!-- –°–ï–ö–¶–ò–Ø 2: –¢–µ—Å—Ç–æ–≤–∞—è —Ñ–æ—Ä–º–∞ -->
    <!-- ============================================================ -->
    <div class="test-section">
      <h3>üìç –°–µ–∫—Ü–∏—è 2: –¢–µ—Å—Ç–æ–≤–∞—è —Ñ–æ—Ä–º–∞</h3>

      <form id="test-form" data-component="validation" class="test-form">
        <div class="form-group">
          <label for="name">–ò–º—è *</label>
          <input type="text" id="name" name="name" class="form-control" required>
        </div>

        <div class="form-group">
          <label for="email">Email *</label>
          <input type="email" id="email" name="email" class="form-control" required>
        </div>

        <!-- –®–∞–±–ª–æ–Ω—ã –æ—à–∏–±–æ–∫ (–°–ö–†–´–¢–´ —á–µ—Ä–µ–∑ modia.css) -->
        <div class="error-templates">
          <span class="text-danger" data-rule="required">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</span>
          <span class="text-danger" data-rule="email">–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email</span>
        </div>

        <div class="form-group mt-3">
          <button type="button" id="btn-check-init" class="btn btn-primary">
            üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
          </button>
        </div>
      </form>

      <div id="component-info" class="registry-display">
        –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ: (–æ–∂–∏–¥–∞–Ω–∏–µ)
      </div>
    </div>

    <!-- ============================================================ -->
    <!-- –°–ï–ö–¶–ò–Ø 3: –ö–æ–Ω—Å–æ–ª—å –ª–æ–≥ -->
    <!-- ============================================================ -->
    <div class="test-section">
      <h3>üìã –ö–æ–Ω—Å–æ–ª—å –ª–æ–≥</h3>
      <div class="event-log" id="console-log" style="max-height: 300px; overflow-y: auto;">
        <div class="log-entry log-info"><small>[00:00:00] –ö–æ–Ω—Å–æ–ª—å –≥–æ—Ç–æ–≤–∞...</small></div>
      </div>
      <div class="test-buttons mt-2">
        <button class="btn btn-outline-secondary" id="btn-clear-log">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
      </div>
    </div>

    <!-- ============================================================ -->
    <!-- –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
    <!-- ============================================================ -->
    <div class="test-buttons mt-4">
      <button class="btn btn-success" id="btn-run-init-test">
        ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
      </button>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="mt-4">
      <a href="test-01-basic-submit.html" class="btn btn-outline-primary">
        ‚Üí –°–ª–µ–¥—É—é—â–∏–π —Ç–µ—Å—Ç: –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
      </a>
    </div>
  </div>

  <!-- ‚úÖ Modia Index (3 —É—Ä–æ–≤–Ω—è –≤–≤–µ—Ä—Ö!) -->
  <script type="module" src="../../../modia/index.js"></script>

  <!-- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç -->
  <script type="module">
    // ============================================================
    // –£–¢–ò–õ–ò–¢–´ –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø
    // ============================================================

    function log(message, type = 'info') {
      const $log = $('#console-log');
      const timestamp = new Date().toLocaleTimeString('ru-RU');
      const cssClass = `log-${type}`;
      $log.append(`<div class="log-entry ${cssClass}"><small>[${timestamp}] ${message}</small></div>`);
      $log.scrollTop($log[0].scrollHeight);
      console.log(`[Init Test] ${message}`);
    }

    function setStatus(status, message) {
      const $status = $('#init-status');
      $status.removeClass('pending success error').addClass(status);
      $status.text(`–°—Ç–∞—Ç—É—Å: ${message}`);
    }

    // ============================================================
    // –ü–†–û–í–ï–†–ö–ê –ó–ê–ì–†–£–ó–ö–ò –°–ö–†–ò–ü–¢–û–í
    // ============================================================

    $(document).ready(function () {
      log('DOM –≥–æ—Ç–æ–≤', 'info');

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ jQuery
      if (typeof $ === 'function') {
        log('‚úÖ jQuery –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
      } else {
        log('‚ùå jQuery –ù–ï –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
        setStatus('error', 'jQuery –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        return;
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ Bootstrap (—á–µ—Ä–µ–∑ –Ω–∞–ª–∏—á–∏–µ –∫–ª–∞—Å—Å–æ–≤)
      if ($('.container').css('max-width')) {
        log('‚úÖ Bootstrap —Å—Ç–∏–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã', 'success');
      } else {
        log('‚ö†Ô∏è Bootstrap —Å—Ç–∏–ª–∏ –º–æ–≥—É—Ç –Ω–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è', 'warn');
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ examples.css (—á–µ—Ä–µ–∑ –Ω–∞–ª–∏—á–∏–µ .test-section)
      if ($('.test-section').css('border')) {
        log('‚úÖ examples.css –ø–æ–¥–∫–ª—é—á—ë–Ω', 'success');
      } else {
        log('‚ö†Ô∏è examples.css –º–æ–∂–µ—Ç –Ω–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è', 'warn');
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ modia.css (—á–µ—Ä–µ–∑ —Å–∫—Ä—ã—Ç–∏–µ .error-templates)
      const $errorTemplates = $('.error-templates');
      if ($errorTemplates.length > 0 && $errorTemplates.css('display') === 'none') {
        log('‚úÖ modia.css –ø–æ–¥–∫–ª—é—á—ë–Ω (—à–∞–±–ª–æ–Ω—ã —Å–∫—Ä—ã—Ç—ã)', 'success');
      } else {
        log('‚ùå modia.css –ù–ï –ø–æ–¥–∫–ª—é—á—ë–Ω (—à–∞–±–ª–æ–Ω—ã –≤–∏–¥–Ω—ã!)', 'error');
        setStatus('error', 'modia.css –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω');
      }

      setStatus('pending', '–û–∂–∏–¥–∞–Ω–∏–µ Modia...');

      // –ñ–¥—ë–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Modia
      setTimeout(checkModiaInit, 500);
    });

    // ============================================================
    // –ü–†–û–í–ï–†–ö–ê MODIA –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò
    // ============================================================

    function checkModiaInit() {
      log('–ü—Ä–æ–≤–µ—Ä–∫–∞ Modia...', 'info');

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ window.Modia
      if (typeof window.Modia !== 'undefined') {
        log('‚úÖ window.Modia –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
        log(`   –í–µ—Ä—Å–∏—è: ${window.Modia.version || '–Ω–µ —É–∫–∞–∑–∞–Ω–∞'}`, 'info');
      } else {
        log('‚ùå window.Modia –ù–ï –¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
        setStatus('error', 'Modia –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        return;
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ logger
      if (typeof window.Modia.log === 'function') {
        log('‚úÖ Logger API –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
        window.Modia.info('–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç Init Test', 'InitTest');
      } else {
        log('‚ùå Logger API –ù–ï –¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ ComponentScanner
      if (typeof window.Modia.ComponentScanner !== 'undefined') {
        log('‚úÖ ComponentScanner –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
      } else {
        log('‚ùå ComponentScanner –ù–ï –¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ
      if (window.__modia_initialized) {
        log('‚úÖ Modia —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ', 'success');
      } else {
        log('‚ö†Ô∏è Modia —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –µ—â—ë –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ', 'warn');
      }

      setStatus('success', 'Modia –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');

      // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏
      $('#btn-check-init').prop('disabled', false);
      log('üîò –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é" –∞–∫—Ç–∏–≤–Ω–∞', 'info');
    }

    // ============================================================
    // –ü–†–û–í–ï–†–ö–ê –ö–û–ú–ü–û–ù–ï–ù–¢–ê
    // ============================================================

    $('#btn-check-init').on('click', function () {
      log('=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ===', 'info');

      const $form = $('#test-form');

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ data-–∞—Ç—Ä–∏–±—É—Ç–∞
      if ($form.attr('data-component') === 'validation') {
        log('‚úÖ –§–æ—Ä–º–∞ –∏–º–µ–µ—Ç data-component="validation"', 'success');
      } else {
        log('‚ùå –§–æ—Ä–º–∞ –ù–ï –∏–º–µ–µ—Ç data-component="validation"', 'error');
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ .data('modia-component')
      const component = $form.data('modia-component');

      if (component) {
        log('‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ .data("modia-component")', 'success');
        log(`   –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä: ${component.constructor.name}`, 'info');
        log(`   componentName: ${component.constructor.componentName}`, 'info');
        log(`   –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: ${JSON.stringify(component.config)}`, 'info');
        log(`   fieldValidators: ${component.fieldValidators?.length || 0} —à—Ç.`, 'info');

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤
        if (component.fieldValidators && component.fieldValidators.length > 0) {
          component.fieldValidators.forEach((validator, i) => {
            log(`   –í–∞–ª–∏–¥–∞—Ç–æ—Ä #${i}: ${validator._getFieldIdentifier()}`, 'info');
          });
        }

        // –í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        $('#component-info').html(
          `<strong>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:</strong> ${component.constructor.name}<br>` +
          `<strong>–ò–º—è:</strong> ${component.constructor.componentName}<br>` +
          `<strong>–ö–æ–Ω—Ñ–∏–≥:</strong> ${JSON.stringify(component.config, null, 2)}<br>` +
          `<strong>fieldValidators:</strong> ${component.fieldValidators?.length || 0} —à—Ç.`
        );

        setStatus('success', '–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        log('=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: –£–°–ü–ï–• ===', 'success');

      } else {
        log('‚ùå –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ù–ï –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ .data("modia-component")', 'error');
        $('#component-info').text('–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
        setStatus('error', '–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        log('=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: –û–®–ò–ë–ö–ê ===', 'error');
      }
    });

    // ============================================================
    // –ö–ù–û–ü–ö–ê –ó–ê–ü–£–°–ö–ê
    // ============================================================

    $('#btn-run-init-test').on('click', function () {
      log('=== –ó–ê–ü–£–°–ö –ü–†–û–í–ï–†–ö–ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò ===', 'info');
      $('#btn-check-init').click();
    });

    // ============================================================
    // –û–ß–ò–°–¢–ö–ê –õ–û–ì–ê
    // ============================================================

    $('#btn-clear-log').on('click', function () {
      $('#console-log').html('<div class="log-entry log-info"><small>[00:00:00] –õ–æ–≥ –æ—á–∏—â–µ–Ω</small></div>');
      log('–õ–æ–≥ –æ—á–∏—â–µ–Ω', 'info');
    });

    // ============================================================
    // –ì–õ–û–ë–ê–õ–¨–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –û–®–ò–ë–û–ö
    // ============================================================

    window.addEventListener('error', function (e) {
      log(`‚ùå –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞: ${e.message} –≤ ${e.filename}:${e.lineno}`, 'error');
      setStatus('error', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
    });

    window.addEventListener('unhandledrejection', function (e) {
      log(`‚ùå –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è Promise-–æ—à–∏–±–∫–∞: ${e.reason}`, 'error');
    });
  </script>
</body>

</html>