<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>Modia ‚Äî –¢–µ—Å—Ç DebugComponent</title>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="../modia/modia.css">
</head>

<body>
  <!-- ‚ö†Ô∏è –ù–ï–¢ data-modia-* –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –Ω–∞ body ‚Äî —Ç–µ—Å—Ç–∏—Ä—É–µ–º —á–∏—Å—Ç—ã–π —Ä–µ–∂–∏–º -->

  <div class="container mt-5">
    <h1>üß™ –¢–µ—Å—Ç DebugComponent</h1>
    <p class="lead">–ü—Ä–æ–≤–µ—Ä–∫–∞: –∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–µ–∂–∏–º–æ–≤ –æ—Ç–ª–∞–¥–∫–∏, –ø—É–±–ª–∏—á–Ω—ã–π API.</p>

    <div class="alert alert-info mt-3">
      <strong>üìç –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º:</strong> <span id="current-mode">–ù–µ –∞–∫—Ç–∏–≤–µ–Ω</span>
    </div>

    <form data-component="validation" class="mt-4">
      <div class="form-group">
        <label>Email:</label>
        <input type="email" class="form-control" name="email" required>
      </div>
      <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>

    <div class="test-buttons mt-4">
      <button id="test-is-enabled" class="btn btn-success mr-2">‚úÖ isEnabled()</button>
      <button id="test-get-mode" class="btn btn-info mr-2">üìä getMode()</button>
      <button id="test-registry" class="btn btn-warning">üìã getComponentsRegistry()</button>
    </div>

    <div id="debug-output" class="mt-4 p-3 bg-light border rounded"></div>

    <hr class="my-5">
    <h3>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
    <ul>
      <li><strong>–ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:</strong> <code>isEnabled() = false</code>, <code>getMode() = null</code></li>
      <li><strong>?modia-debug:</strong> <code>isEnabled() = true</code>, <code>getMode() = 'debug'</code></li>
      <li><strong>?modia-log:</strong> <code>isEnabled() = true</code>, <code>getMode() = 'log'</code></li>
      <li>–†–µ–µ—Å—Ç—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ API</li>
    </ul>

    <h3>üîó –°—Å—ã–ª–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h3>
    <div class="mt-3">
      <a href="test-03-debug.html" class="btn btn-secondary mr-2">–ë–µ–∑ —Ä–µ–∂–∏–º–∞</a>
      <a href="test-03-debug.html?modia-debug" class="btn btn-primary mr-2">?modia-debug</a>
      <a href="test-03-debug.html?modia-log" class="btn btn-success mr-2">?modia-log</a>
      <a href="test-03-debug.html?modia-diag" class="btn btn-info">?modia-diag</a>
    </div>
  </div>

  <script type="module">
    import '../modia/index.js';

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º
    function updateModeDisplay() {
      const enabled = Modia.debug.isEnabled();
      const mode = Modia.debug.getMode();
      const modeText = mode ? mode : '–ù–µ –∞–∫—Ç–∏–≤–µ–Ω';
      $('#current-mode').text(`${modeText} (enabled: ${enabled})`);
    }

    $('#test-is-enabled').on('click', () => {
      const enabled = Modia.debug.isEnabled();
      $('#debug-output').html(`<div>isEnabled(): <strong>${enabled}</strong></div>`);
      Modia.info(`isEnabled() = ${enabled}`, 'Test-03');
    });

    $('#test-get-mode').on('click', () => {
      const mode = Modia.debug.getMode();
      $('#debug-output').html(`<div>getMode(): <strong>${mode || 'null'}</strong></div>`);
      Modia.info(`getMode() = ${mode}`, 'Test-03');
    });

    $('#test-registry').on('click', () => {
      const registry = Modia.debug.getComponentsRegistry();
      const output = registry.map((inst, i) =>
        `<div>[${i}] ${inst.constructor.name} –Ω–∞ #${inst.$el[0].id || 'no-id'}</div>`
      ).join('');
      $('#debug-output').html(output || '–†–µ–µ—Å—Ç—Ä –ø—É—Å—Ç');
      Modia.info(`–†–µ–µ—Å—Ç—Ä: ${registry.length} –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤`, 'Test-03');
    });

    // –ê–≤—Ç–æ-—Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    $(document).on('modia:initialized', () => {
      setTimeout(() => {
        updateModeDisplay();
        Modia.info(`Debug enabled: ${Modia.debug.isEnabled()}`, 'Test-03');
        Modia.info(`Debug mode: ${Modia.debug.getMode()}`, 'Test-03');
      }, 500);
    });
  </script>
</body>

</html>