<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modia ‚Äî Legacy Validate-on-Click (All Errors)</title>

  <!-- ‚úÖ jQuery 3.5.1 CDN (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û) -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <!-- ‚úÖ Bootstrap 4.6.2 CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <!-- –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ -->
  <style>
    body {
      background-color: #f5f6fa;
      padding: 20px;
    }

    .card {
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .card-header {
      background-color: #fff;
      border-bottom: 1px solid #e9ecef;
      font-weight: 600;
    }

    .form-label {
      font-weight: 500;
      margin-bottom: 0.5rem;
    }

    .form-label abbr[title="required"] {
      color: #dc3545;
      text-decoration: none;
    }

    .text-danger {
      color: #dc3545 !important;
      font-size: 0.875rem;
      margin-top: 0.25rem;
      display: block;
    }

    .is-invalid {
      border-color: #dc3545 !important;
      background-color: #ffe6e6 !important;
    }

    .error-template {
      display: none;
    }

    .console-log {
      max-height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.85rem;
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 10px;
    }

    .btn {
      margin-right: 5px;
    }

    .expected-result {
      background-color: #d4edda;
      border: 1px solid #c3e6cb;
      border-radius: 4px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .expected-result h4 {
      margin-top: 0;
      color: #155724;
    }

    .validation-status {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
    }

    .validation-status.pending {
      background-color: #e2e3e5;
      color: #383d41;
    }

    .validation-status.success {
      background-color: #d4edda;
      color: #155724;
    }

    .validation-status.error {
      background-color: #f8d7da;
      color: #721c24;
    }
  </style>
</head>

<body>
  <div class="container mt-5">
    <h1>üß™ Legacy Validate-on-Click (All Errors)</h1>
    <p class="text-muted">–ü—Ä–∏–º–µ—Ä –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–∑ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–ï –æ—à–∏–±–∫–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</p>

    <!-- –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div class="expected-result">
      <h4>‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
      <ul>
        <li>–ö–ª–∏–∫ –Ω–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö <code>[required]</code> –ø–æ–ª–µ–π</li>
        <li>–ü—É—Å—Ç–æ–µ required –ø–æ–ª–µ ‚Üí –∫—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç "–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"</li>
        <li>–ü—É—Å—Ç–æ–µ required –ø–æ–ª–µ ‚Üí —Ä–æ–∑–æ–≤—ã–π —Ñ–æ–Ω input (<code>.is-invalid</code>)</li>
        <li><strong>–ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –í–°–ï –æ—à–∏–±–∫–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</strong> (–Ω–µ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è)</li>
        <li>–°–∫—Ä—ã—Ç—ã–µ/–æ—Ç–∫–ª—é—á—ë–Ω–Ω—ã–µ –ø–æ–ª—è –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è</li>
        <li>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ <code>data-input-field</code> –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤</li>
        <li>–ù–∞—Ç–∏–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è (–∫–Ω–æ–ø–∫–∞ <code>type="button"</code>)</li>
      </ul>
    </div>

    <!-- –§–æ—Ä–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π -->
    <div class="card">
      <h6 class="card-header">–û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è</h6>
      <div class="card-body">
        <form id="regulated_query_form">

          <!-- –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ -->
          <div class="form-group">
            <label class="form-label" for="regulated_query_versions_attributes_0_name">
              <abbr title="required">*</abbr> –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
            </label>
            <input type="text" class="form-control string required" id="regulated_query_versions_attributes_0_name"
              name="regulated_query[versions_attributes][0][name]" required placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ"
              value="">
            <!-- –û—à–∏–±–∫–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—é–¥–∞ -->
          </div>

          <!-- –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–µ–π—Å—Ç–≤–∏—è -->
          <div class="form-group">
            <label class="form-label" for="regulated_query_versions_attributes_0_published_at">
              <abbr title="required">*</abbr> –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–µ–π—Å—Ç–≤–∏—è –†–ó
            </label>
            <input type="text" class="form-control string required datepicker-base published-at-field"
              id="regulated_query_versions_attributes_0_published_at"
              name="regulated_query[versions_attributes][0][published_at]" required placeholder="–î–î.–ú–ú.–ì–ì–ì–ì" value="">
            <!-- –û—à–∏–±–∫–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—é–¥–∞ -->
          </div>

          <!-- –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è (–Ω–µ required) -->
          <div class="form-group">
            <label class="form-label" for="regulated_query_versions_attributes_0_published_till">
              –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è –†–ó
            </label>
            <input type="text" class="form-control string optional datepicker-base validatable-published-till-field"
              id="regulated_query_versions_attributes_0_published_till"
              name="regulated_query[versions_attributes][0][published_till]"
              placeholder="–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è –≤–µ—Ä—Å–∏–∏" value="">
          </div>

          <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
          <div class="form-group">
            <label class="form-label" for="regulated_query_versions_attributes_0_description">
              <abbr title="required">*</abbr> –û–ø–∏—Å–∞–Ω–∏–µ
            </label>
            <textarea class="form-control text required" id="regulated_query_versions_attributes_0_description"
              name="regulated_query[versions_attributes][0][description]" rows="5" required
              placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞"></textarea>
            <!-- –û—à–∏–±–∫–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—é–¥–∞ -->
          </div>

          <!-- –î–æ–∫—É–º–µ–Ω—Ç –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–Ω–µ required) -->
          <div class="form-group">
            <label class="form-label" for="regulated_query_versions_attributes_0_legal_act_files_attributes_0_file">
              –î–æ–∫—É–º–µ–Ω—Ç –æ—Å–Ω–æ–≤–∞–Ω–∏—è
            </label>
            <p class="text-muted small">–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</p>
            <div>
              <label class="btn btn-link pl-0">
                –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
                <input class="user-edit-fileinput file optional new-file-input logo-file-input" type="file"
                  name="regulated_query[versions_attributes][0][legal_act_files_attributes][0][file]"
                  id="regulated_query_versions_attributes_0_legal_act_files_attributes_0_file">
              </label>
            </div>
          </div>

          <!-- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ -->
          <div class="form-group">
            <label class="form-label" for="execution_restriction_nsi_select">
              <abbr title="required">*</abbr> –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
            </label>
            <select class="form-control select required" id="execution_restriction_nsi_select"
              name="regulated_query[versions_attributes][0][execution_restriction_id]" required>
              <option value="">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
              <option value="8155">–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ</option>
              <option value="8156">–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ</option>
              <option value="8157">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
            </select>
            <!-- –û—à–∏–±–∫–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—é–¥–∞ -->
          </div>

          <!-- SQL –∑–∞–ø—Ä–æ—Å (contenteditable) -->
          <div class="form-group">
            <label class="form-label">
              <abbr title="required">*</abbr> –ò—Ç–æ–≥–æ–≤—ã–π SQL –∑–∞–ø—Ä–æ—Å
            </label>
            <div class="code-edit-box" id="sql_editor" contenteditable="true" required
              style="border: 1px solid #ced4da; border-radius: 4px; padding: 10px; min-height: 100px; background: #fff;">
              <code class="language-sql">SELECT * FROM table</code>
            </div>
            <!-- –û—à–∏–±–∫–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—é–¥–∞ -->
          </div>

          <!-- –ß–µ–∫–±–æ–∫—Å "–í –∞—Ä—Ö–∏–≤–µ" (–Ω–µ required) -->
          <div class="form-group">
            <div class="custom-control custom-checkbox">
              <input type="checkbox" class="custom-control-input boolean optional" id="regulated_query_archived"
                name="regulated_query[archived]" value="1">
              <label class="custom-control-label text-red" for="regulated_query_archived">
                –í –∞—Ä—Ö–∏–≤–µ
              </label>
            </div>
          </div>

          <!-- –ö–Ω–æ–ø–∫–∏ -->
          <div class="mt-4">
            <!-- ‚úÖ type="button" ‚Äî –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–∞—Ç–∏–≤–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –±—Ä–∞—É–∑–µ—Ä–∞ -->
            <button type="button" class="btn btn-primary validate-on-click">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button type="button" class="btn btn-outline-primary" onclick="history.back()">–û—Ç–º–µ–Ω–∞</button>
            <button type="button" class="btn btn-secondary" id="btn-clear">–û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫–∏</button>
            <button type="button" class="btn btn-info" id="btn-fill">–ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –ø–æ–ª—è</button>
          </div>
        </form>
      </div>
    </div>

    <!-- –®–∞–±–ª–æ–Ω—ã –æ—à–∏–±–æ–∫ (–Ω–µ–≤–∏–¥–∏–º—ã–µ) -->
    <div class="error-template d-none" id="error_span">
      <span class="text-danger">–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º</span>
    </div>

    <!-- –ö–æ–Ω—Å–æ–ª—å –ª–æ–≥ -->
    <div class="card mt-4">
      <h6 class="card-header">üìã –ö–æ–Ω—Å–æ–ª—å –ª–æ–≥</h6>
      <div class="card-body">
        <div id="console-log" class="console-log">
          <small class="text-muted">–õ–æ–≥–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</small>
        </div>
      </div>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏ -->
    <div class="card mt-4">
      <h6 class="card-header">üìä –°—Ç–∞—Ç—É—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏</h6>
      <div class="card-body">
        <div id="validation-status" class="validation-status pending">
          <span>‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ</span>
        </div>
        <div id="error-summary" class="mt-2"></div>
      </div>
    </div>

    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
    <div class="card mt-4">
      <h6 class="card-header">üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h6>
      <div class="card-body">
        <ol>
          <li>–û—á–∏—Å—Ç–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è (–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫–∏")</li>
          <li>–ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"</li>
          <li><strong>–í—Å–µ –ø—É—Å—Ç—ã–µ required –ø–æ–ª—è –±—É–¥—É—Ç –ø–æ–¥—Å–≤–µ—á–µ–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</strong></li>
          <li>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" —Å–Ω–æ–≤–∞</li>
          <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –ª–æ–≥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏</li>
        </ol>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // –£—Ç–∏–ª–∏—Ç—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    // ============================================
    function log(message, type = 'info') {
      const $log = $('#console-log');
      const timestamp = new Date().toLocaleTimeString('ru-RU');
      const color = type === 'error' ? 'text-danger' : type === 'success' ? 'text-success' : 'text-muted';
      $log.append(`<div class="${color}"><small>[${timestamp}] ${message}</small></div>`);
      $log.scrollTop($log[0].scrollHeight);
      console.log(`[Validate-on-Click] ${message}`);
    }

    function updateStatus(isValid, message, errorCount = 0) {
      const $status = $('#validation-status');
      const $summary = $('#error-summary');

      if (isValid === null) {
        $status.removeClass('success error').addClass('pending').html('<span>‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ</span>');
        $summary.html('');
      } else if (isValid) {
        $status.removeClass('pending error').addClass('success').html('<span>‚úÖ –í–∞–ª–∏–¥–Ω–æ</span> ' + message);
        $summary.html('');
      } else {
        $status.removeClass('pending success').addClass('error').html('<span>‚ùå –û—à–∏–±–∫–∞</span> ' + message);
        $summary.html(`<strong>–ù–∞–π–¥–µ–Ω–æ –æ—à–∏–±–æ–∫: ${errorCount}</strong>`);
      }
    }

    // ============================================
    // –§—É–Ω–∫—Ü–∏–∏ –∏–∑ legacy-–∫–æ–¥–∞
    // ============================================

    /**
     * –ù–∞—Ö–æ–¥–∏—Ç –±–ª–∏–∂–∞–π—à–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∞–ª–∏–¥–∞—Ü–∏–∏
     */
    function closestValidationContainer(event) {
      const $target = $(event.target);
      const $form = $target.closest('form');
      if ($form.length > 0) {
        return $form;
      }
      return $target.closest('[data-component="validation"]') || $('body');
    }

    /**
     * –û—á–∏—â–∞–µ—Ç –≤—Å–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
     */
    function clearErrorsContext(event) {
      const form_object = closestValidationContainer(event);
      form_object.find('.text-danger').remove();
      form_object.find('.is-invalid').removeClass('is-invalid');
      log('üßπ –û—à–∏–±–∫–∏ –æ—á–∏—â–µ–Ω—ã');
    }

    /**
     * –ü–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ contenteditable)
     */
    function getFieldValue($field) {
      if ($field.is('[contenteditable]')) {
        return $field.text().trim();
      }
      return $field.val();
    }

    // ============================================
    // –û—Å–Ω–æ–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø ‚Äî –≤—Å–µ –æ—à–∏–±–∫–∏)
    // ============================================
    $(document).ready(function () {
      log('‚úÖ Document ready');
      log('üìã –û–±—Ä–∞–±–æ—Ç—á–∏–∫ .validate-on-click –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
      log('‚öôÔ∏è –†–µ–∂–∏–º: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –í–°–ï –æ—à–∏–±–∫–∏ (–Ω–µ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é)');
      updateStatus(null);

      $('body').on('click', '.validate-on-click', function (event) {
        log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
        log('üñ±Ô∏è –ö–ª–∏–∫ –Ω–∞ .validate-on-click');

        const form_object = closestValidationContainer(event);
        log('üì¶ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', form_object[0].tagName);

        clearErrorsContext(event);

        let firstErrorField = null;
        let errorCount = 0;
        const errorFields = [];

        // ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º –í–°–ï –ø–æ–ª—è (–±–µ–∑ break ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ!)
        for (var i = 0, len = form_object.find('[required]').length; i < len; i++) {
          let required_field = $(form_object.find('[required]')[i]);
          let value_field, has_error;

          log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—è [${i + 1}/${len}]:`, required_field.attr('id') || required_field.attr('name'));

          // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∫—Ä—ã—Ç—ã–µ –∏ –æ—Ç–∫–ª—é—á—ë–Ω–Ω—ã–µ –ø–æ–ª—è
          if ($(required_field).is(":hidden") || $(required_field).is(":disabled")) {
            log('‚äò –ü—Ä–æ–ø—É—â–µ–Ω–æ (—Å–∫—Ä—ã—Ç–æ–µ –∏–ª–∏ –æ—Ç–∫–ª—é—á—ë–Ω–Ω–æ–µ)');
            continue;
          }

          // –ù–∞—Ö–æ–¥–∏–º form-group
          let form_group = required_field.closest('.form-group');
          if (form_group.length == 0) {
            form_group = required_field.find('.form-group');
          }

          // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—à–∏–±–∫–∏ –≤ —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ
          form_group.children('.text-danger').remove();

          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –∑–Ω–∞—á–µ–Ω–∏—è (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ data-input-field)
          if ($(required_field.data('input-field')).length > 0) {
            value_field = $(required_field.data('input-field'));
            log('üìç –ò—Å—Ç–æ—á–Ω–∏–∫ –∑–Ω–∞—á–µ–Ω–∏—è: data-input-field ‚Üí', value_field.attr('id'));
          } else {
            value_field = required_field;
          }

          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è
          if (value_field.length > 1) {
            // –ú–∞—Å—Å–∏–≤ –ø–æ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, name='tags[]')
            has_error = $.inArray(true, $.map(value_field, function (val, key) {
              return $(val).val() != '';
            })) === -1;
            log('üìä –ú–∞—Å—Å–∏–≤ –ø–æ–ª–µ–π, has_error:', has_error);
          } else {
            // –û–¥–∏–Ω–æ—á–Ω–æ–µ –ø–æ–ª–µ
            const fieldValue = getFieldValue($(value_field));
            has_error = (fieldValue === '' || fieldValue === null);
            log('üìä –û–¥–∏–Ω–æ—á–Ω–æ–µ –ø–æ–ª–µ, –∑–Ω–∞—á–µ–Ω–∏–µ:', fieldValue, ', has_error:', has_error);
          }

          // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, –Ω–æ –ù–ï –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–∏–∫–ª
          if (has_error) {
            log('‚ùå –û–®–ò–ë–ö–ê: –ø–æ–ª–µ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ');

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –æ—à–∏–±–∫–∏
            value_field.addClass('is-invalid');

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –∏–∑ —à–∞–±–ª–æ–Ω–∞
            form_group.append($('#error_span').html());

            // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –ø–µ—Ä–≤–æ–µ –æ—à–∏–±–æ—á–Ω–æ–µ –ø–æ–ª–µ (–¥–ª—è —Ñ–æ–∫—É—Å–∞)
            if (!firstErrorField) {
              firstErrorField = required_field;
            }

            errorCount++;
            errorFields.push(required_field.attr('id') || required_field.attr('name'));

            // ‚ö†Ô∏è –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–ï–¢ break ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π!
            log('‚è≠Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å–ª–µ–¥—É—é—â–∏—Ö –ø–æ–ª–µ–π...');
          } else {
            log('‚úÖ –ü–æ–ª–µ –≤–∞–ª–∏–¥–Ω–æ');
          }
        }

        // ‚úÖ preventDefault() –≤—ã–∑—ã–≤–∞–µ–º –ü–û–°–õ–ï –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö –ø–æ–ª–µ–π
        if (errorCount > 0) {
          log(`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`);
          log(`‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –ù–ï –ø—Ä–æ–π–¥–µ–Ω–∞. –û—à–∏–±–æ–∫: ${errorCount}`);
          log(`üìã –û—à–∏–±–æ—á–Ω—ã–µ –ø–æ–ª—è: ${errorFields.join(', ')}`);

          event.preventDefault();
          event.stopImmediatePropagation();

          // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–µ –æ—à–∏–±–æ—á–Ω–æ–µ –ø–æ–ª–µ
          if (firstErrorField) {
            firstErrorField.focus();
            log('üéØ –§–æ–∫—É—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞:', firstErrorField.attr('id'));
          }

          updateStatus(false, `–ù–∞–π–¥–µ–Ω–æ ${errorCount} –æ—à–∏–±–æ–∫`, errorCount);
        } else {
          log(`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`);
          log(`‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞. –í—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã.`);
          updateStatus(true, '–§–æ—Ä–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ');

          // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É
          // form_object.submit();
        }
      });

      // –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –æ—à–∏–±–æ–∫
      $('#btn-clear').on('click', function () {
        log('üßπ –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ –∫–Ω–æ–ø–∫–µ');
        $('.text-danger').remove();
        $('.is-invalid').removeClass('is-invalid');
        updateStatus(null);
      });

      // –ö–Ω–æ–ø–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π (–¥–ª—è —Ç–µ—Å—Ç–∞)
      $('#btn-fill').on('click', function () {
        log('üìù –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏');

        $('#regulated_query_versions_attributes_0_name').val('–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å ‚Ññ' + Date.now());
        $('#regulated_query_versions_attributes_0_published_at').val('19.02.2026');
        $('#regulated_query_versions_attributes_0_description').val('–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏');
        $('#execution_restriction_nsi_select').val('8155');
        $('#sql_editor').text('SELECT * FROM test_table WHERE id = 1');

        $('.text-danger').remove();
        $('.is-invalid').removeClass('is-invalid');
        updateStatus(null);

        log('‚úÖ –í—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.');
      });

      // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ
      $('form').on('input', 'input, textarea, select, [contenteditable]', function () {
        const $field = $(this);
        if ($field.val() && $field.val().trim() !== '') {
          $field.removeClass('is-invalid');
          $field.closest('.form-group').children('.text-danger').remove();
        }
      });

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      log('üöÄ –ü—Ä–∏–º–µ—Ä –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏.');
    });
  </script>
</body>

</html>